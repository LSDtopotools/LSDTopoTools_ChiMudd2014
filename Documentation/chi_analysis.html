<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0">
<meta name="author" content="Simon M. Mudd and Fiona J. Clubb, School of GeoSciences, University of Edinburgh">
<title>User guide to chi analysis</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-check-square-o:first-child,ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after,a[href^="mailto:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  }
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.4.0/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>User guide to chi analysis</h1>
<div class="details">
<span id="author" class="author">Simon M. Mudd and Fiona J. Clubb, School of GeoSciences, University of Edinburgh</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface_by_simon_mudd">Preface by Simon Mudd</a></li>
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_background">1.1. Background</a></li>
<li><a href="#_channel_incision_and_geometry">1.2. Channel incision and geometry</a></li>
<li><a href="#_what_is_in_these_documents">1.3. What is in these documents</a></li>
</ul>
</li>
<li><a href="#_getting_the_software">2. Getting the software</a>
<ul class="sectlevel2">
<li><a href="#_starting_up_on_your_own_linux_machine">2.1. Starting up on your own Linux machine</a></li>
<li><a href="#_starting_up_on_a_non_linux_operating_system_windows_macos">2.2. Starting up on a non-Linux operating system (Windows, MacOS)</a></li>
<li><a href="#_troubleshooting_a_vagrant_server">2.3. Troubleshooting a vagrant server</a></li>
<li><a href="#_installing_the_code_and_setting_up_directories">2.4. Installing the code and setting up directories</a></li>
</ul>
</li>
<li><a href="#_preparing_your_data">3. Preparing your data</a>
<ul class="sectlevel2">
<li><a href="#_get_some_data">3.1. Get some data</a></li>
<li><a href="#_use_gdal">3.2. Use GDAL</a></li>
<li><a href="#_stupid_nodata">3.3. Stupid nodata</a></li>
</ul>
</li>
<li><a href="#_running_the_chi_analysis_options_and_outputs">4. Running the chi analysis: options and outputs</a>
<ul class="sectlevel2">
<li><a href="#_text_editors_for_modifying_files">4.1. Text editors for modifying files</a></li>
<li><a href="#_the_parameter_file">4.2. The parameter file</a></li>
<li><a href="#_parameter_file_options">4.3. Parameter file options</a>
<ul class="sectlevel3">
<li><a href="#_basic_file_input_and_output">4.3.1. Basic file input and output</a></li>
<li><a href="#_dem_preprocessing">4.3.2. DEM preprocessing</a></li>
<li><a href="#_selecting_channels_and_basins">4.3.3. Selecting channels and basins</a></li>
<li><a href="#_basic_data_output_before_calculating_chi">4.3.4. Basic data output (before calculating chi)</a></li>
<li><a href="#_basic_parameters_for_the_chi_coordinate">4.3.5. Basic parameters for the chi coordinate</a></li>
<li><a href="#_burning_rasters_to_csv">4.3.6. Burning rasters to csv</a></li>
<li><a href="#_parameters_for_exploring_the_em_m_n_em_ratio_with_chi_analysis">4.3.7. Parameters for exploring the <em>m/n</em> ratio with chi analysis</a></li>
<li><a href="#_parameters_for_exploring_the_em_m_n_em_ratio_with_slope_area_analysis">4.3.8. Parameters for exploring the <em>m/n</em> ratio with slope-area analysis</a></li>
<li><a href="#_parameters_for_segmentation_of_channels">4.3.9. Parameters for segmentation of channels</a></li>
<li><a href="#_printing_of_simple_chi_maps">4.3.10. Printing of simple chi maps</a></li>
<li><a href="#_chi_maps_with_segmentation_and_basin_and_channel_selection">4.3.11. Chi maps with segmentation and basin and channel selection</a></li>
<li><a href="#_parameters_for_dealing_with_discharge_rather_than_drainage_area">4.3.12. Parameters for dealing with discharge rather than drainage area</a></li>
</ul>
</li>
<li><a href="#_example_parameter_files">4.4. Example parameter files</a></li>
<li><a href="#_output_data_formats">4.5. Output data formats</a></li>
<li><a href="#_the_different_outputs_and_how_to_get_them">4.6. The different outputs and how to get them</a>
<ul class="sectlevel3">
<li><a href="#_raster_output">4.6.1. Raster output</a></li>
<li><a href="#_point_data_usually_output_as_csv">4.6.2. Point data (usually output as csv)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_visualisation">5. Visualisation</a>
<ul class="sectlevel2">
<li><a href="#_using_a_gis">5.1. Using a GIS</a></li>
<li><a href="#_using_python">5.2. Using python</a>
<ul class="sectlevel3">
<li><a href="#_setting_up_python">5.2.1. Setting up Python</a></li>
<li><a href="#_setting_up_python_using_a_conda_virtual_environment">5.2.2. Setting up python using a conda virtual environment</a></li>
<li><a href="#_using_spyder">5.2.3. Using Spyder</a></li>
<li><a href="#_getting_our_plotting_tools">5.2.4. Getting our plotting tools</a></li>
<li><a href="#_fixing_python_gdal_in_windows">5.2.5. Fixing python gdal in windows</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_examples_of_chi_analysis">6. Examples of chi analysis</a>
<ul class="sectlevel2">
<li><a href="#_get_the_example_data">6.1. Get the example data</a></li>
<li><a href="#_first_example_basic_dem_steps_and_basin_selection">6.2. First example: Basic DEM steps and Basin selection</a>
<ul class="sectlevel3">
<li><a href="#_some_comments_on_basin_selection">6.2.1. Some comments on basin selection</a></li>
</ul>
</li>
<li><a href="#_using_our_example_scripts">6.3. Using our example scripts</a></li>
<li><a href="#_visualising_example_one_data">6.4. Visualising example one data</a>
<ul class="sectlevel3">
<li><a href="#_example_one_part_one_the_hillshade">6.4.1. Example one, part one: the hillshade</a></li>
<li><a href="#_example_one_part_two_coloured_basins">6.4.2. Example one, part two: coloured basins</a></li>
<li><a href="#_example_one_part_three_numbered_basins">6.4.3. Example one, part three: numbered basins</a></li>
<li><a href="#_example_one_part_four_renaming_basins">6.4.4. Example one, part four: renaming basins</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_calculating_concavity">7. Calculating concavity</a>
<ul class="sectlevel2">
<li><a href="#_before_you_start">7.1. Before you start</a></li>
<li><a href="#_options_you_need_for_calculating_the_most_likely_concavity">7.2. Options you need for calculating the most likely concavity</a>
<ul class="sectlevel3">
<li><a href="#_some_key_options">7.2.1. Some key options</a></li>
<li><a href="#_other_options_all_have_sensible_defaults">7.2.2. Other options: all have sensible defaults</a></li>
<li><a href="#_what_the_code_estimate_best_fit_movern_code_routine_does">7.2.3. What the <code>estimate_best_fit_movern</code> routine does</a></li>
</ul>
</li>
<li><a href="#_running_the_em_m_n_em_analysis">7.3. Running the <em>m/n</em> analysis</a></li>
<li><a href="#_visualising_the_results_of_our_m_n_analyses">7.4. Visualising the results of our m/n analyses</a>
<ul class="sectlevel3">
<li><a href="#_generating_all_the_plots">7.4.1. Generating all the plots</a></li>
<li><a href="#_what_sort_of_plots_do_i_get">7.4.2. What sort of plots do I get?</a></li>
</ul>
</li>
<li><a href="#_interpreting_results_from_the_m_n_analyses_and_pitfalls">7.5. Interpreting results from the m/n analyses and pitfalls</a>
<ul class="sectlevel3">
<li><a href="#_uncertainty_and_confidence_in_the_results">7.5.1. Uncertainty and confidence in the results</a></li>
<li><a href="#_parameter_values_that_appear_to_influence_results">7.5.2. Parameter values that appear to influence results</a></li>
<li><a href="#_some_typical_landscapes">7.5.3. Some typical landscapes</a></li>
<li><a href="#_advice_for_presenting_results">7.5.4. Advice for presenting results</a></li>
<li><a href="#_troubleshooting">7.5.5. Troubleshooting</a></li>
</ul>
</li>
<li><a href="#_files_output_by_the_m_n_analysis">7.6. Files output by the m/n analysis</a></li>
<li><a href="#_all_options_used_in_the_m_n_analyses">7.7. All options used in the m/n analyses</a>
<ul class="sectlevel3">
<li><a href="#_parameters_for_exploring_the_em_m_n_em_ratio_with_chi_analysis_2">7.7.1. Parameters for exploring the <em>m/n</em> ratio with chi analysis</a></li>
<li><a href="#_parameters_for_exploring_the_em_m_n_em_ratio_with_slope_area_analysis_2">7.7.2. Parameters for exploring the <em>m/n</em> ratio with slope-area analysis</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_preface_by_simon_mudd">Preface by Simon Mudd</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Channels in upland landscapes and mountains are not just beautiful. They also store information about tectonics, lithology, erosion and climate, and how those things have changed though time. Extracting this information is a challenging task that has occupied the efforts of geomorphologists for several hundred years. I will wait while you read <a href="https://en.wikipedia.org/wiki/John_Wesley_Powell">John Wesley Powell&#8217;s</a> <a href="https://archive.org/details/explorationcolo01goodgoog">book on the exploration of the Colorado river from 1875</a>. Finished? Excellent.</p>
</div>
<div class="paragraph">
<p>Over the last few decades we have built up a theoretical basis for quantifying channel profiles and interpreting their steepness. We now have excellent global coverage of topography, so getting topographic data from any river in the world has never been easier. Analysis of that data can be time consuming and difficult, however. Over the last 5 years here at Edinburgh we have developed tools for automating analysis of river profiles. These tools sit within our software: <a href="http://lsdtopotools.github.io/">LSDTopoTools</a>. The motivation to develop these tools is our belief that any analysis of topography in support of geomorphic work should be easily reproduced by readers of original papers.</p>
</div>
<div class="paragraph">
<p>This website deals with those components of <strong>LSDTopoTools</strong> dedicated to analysing channels, which builds upon some of the work we <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/full">published in 2014</a>. That software was rather difficult to run. After a few years of attempting to get undergraduates to use it, and having feedback from other users, we are pleased to present a updated version of the code. The new version is a much more automated version of the original code. In addition, we have substantially added flexibility and a number of new features. We hope to publish a description of the new features alongside some insights into landscape evolution in the near future. For now, I hope you find this easy enough to understand and install so that you can start exploring your own favourite rivers. I&#8217;m always pleaded to hear from users, so don&#8217;t hesitate to contact me about the software.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the theory behind analysis of channels using both slope-area analysis and chi (the greek letter \(\chi\), which I have been <a href="https://www.youtube.com/watch?v=vPEtRc05G7Q#t=1m46s">pronouncing incorrectly for some time</a>) analysis. If you just want to run the software skip ahead to the section <a href="#_getting_the_software">Getting the software</a>.</p>
</div>
<div class="sect2">
<h3 id="_background">1.1. Background</h3>
<div class="paragraph">
<p>In the late 1800s, <a href="https://en.wikipedia.org/wiki/Grove_Karl_Gilbert">G.K. Gilbert</a> proposed that bedrock channel incision should be proportional to topographic gradients and the amount of water flowing in a channel.</p>
</div>
<div class="quoteblock">
<div class="title">From <a href="https://pubs.er.usgs.gov/publication/70039916">The USGS report on the Geology of the Henry Mountains</a></div>
<blockquote>
We have already seen that erosion is favored by declivity. Where the declivity is great the agents of erosion are powerful; where it is small they are weak; where there is no declivity they are powerless. Moreover it has been shown that their power increases with the declivity in more than simple ratio.
</blockquote>
<div class="attribution">
&#8212; G.K. Gilbert<br>
<cite>Geology of the Henry Mountains 1877</cite>
</div>
</div>
<div class="paragraph">
<p>Since then, many geomorpholgists have attempted to extract information about erosion rates from channel profiles.
Chi analysis is a method of extracting information from channel profiles that attempts to compare channels with different discharges first proposed by <a href="https://eapsweb.mit.edu/people/lhroyden">Leigh Royden</a> and colleagues at MIT.
<a href="https://lsdtopotools.github.io/">LSDTopoTools</a> has a number of tools for performing chi analysis.</p>
</div>
<div class="paragraph">
<p>This document gives instructions on how to use the segment fitting tool for channel profile analysis
developed by <a href="http://www.geos.ed.ac.uk/homes/smudd">Simon Mudd</a> and colleagues at the <a href="http://www.ed.ac.uk/geosciences">University of Edinburgh</a>.
The tool is used to examine the geometry of channels using the integral method of channel profile analysis.
For background to the method, and a description of the algorithms, we refer the reader to
<a href="http://www.http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/abstract">Mudd et al. (2014)</a>.
For background into the strengths of the integral method of channel profile analysis,
the user should read <a href="http://mit.edu/perron/www/files/PerronRoyden13.pdf">Perron and Royden (2013, ESPL)</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_channel_incision_and_geometry">1.2. Channel incision and geometry</h3>
<div class="paragraph">
<p>Following observations made by early workers such as Gilbert, later workers proposed models to explain erosion rates in channels. Many of these models state that erosion rate is proportional to both topographic slope and to discharge. The relationship to discharge is related to a number of factors, including how likeley the river is to pluck material from the bed, and how much sediment it can carry. Bedload can damage the bed and thus bedload particles can act as "tools" to erode the bed. A number of formulations to capture this behaviour have been proposed (e.g. <a href="http://gsabulletin.gsapubs.org/content/94/6/739">Howard and Kerby, 1983</a>; <a href="http://onlinelibrary.wiley.com/doi/10.1029/94WR00757/abstract">Howard, 1994</a>; <a href="http://onlinelibrary.wiley.com/doi/10.1029/1999JB900120/abstract">Whipple and Tucker 1999</a>; <a href="http://onlinelibrary.wiley.com/doi/10.1029/2009JF001655/abstract">Gasparini and Brandon, 2011</a>) and these formulations can be generalised into the stream power incision model (SPIM):</p>
</div>
<div class="stemblock">
<div class="content">
\[E = K A^m S^n\]
</div>
</div>
<div class="paragraph">
<p>where <em>E</em> is the long-term fluvial incision rate, <em>A</em> is the upstream drainage area, <em>S</em> is the channel gradient, <em>K</em> is an erodibility coefficient, which is a measure of the efficiency of the incision process, and <em>m</em> and _n$_are constant exponents.  In order to model landscape evolution, the SPIM is often combined with detachment-limited mass balance, where:</p>
</div>
<div class="stemblock">
<div class="content">
\[\frac{\partial z}{\partial t} = U - E = U - K A^m \Big(\frac{\partial z}{\partial x_d}\Big)^n\]
</div>
</div>
<div class="paragraph">
<p>where <em>z</em> is the elevation of the channel bed, <em>t</em> is time, <em>x<sub>d</sub></em> is the distance downstream, and <em>U</em> is the rock uplift rate, equivalent to the rate of baselevel lowering if the baselevel elevation is fixed.</p>
</div>
<div class="paragraph">
<p>In order to examine fluvial response to climatic and tectonic forcing, this differential equation is often rearranged for channel slope, assuming uniform incision rate:</p>
</div>
<div class="stemblock">
<div class="content">
\[S = k_{sn} A^{-\theta}\]
</div>
</div>
<div class="paragraph">
<p>where \(\theta\) = <em>m/n</em>, and represents the concavity of the channel profile, and \(k_{sn} = (E/K)^{\frac{1}{n}}\), and represents the steepness of the profile.  \(\theta\) and <em>k<sub>sn</sub></em> are referred to as the concavity and steepness indices respectively. This relationship therefore predicts a power-law relationship between slope and drainage area, which is often represented on a logarithmic scale.  The concavity and steepness indices can be extracted from plots of slope against drainage area along a channel, where \(\theta\) is the gradient of a best-fit line through the data, and <em>k<sub>sn</sub></em> is the y-intercept. These slope-area plots have been used by many studies to examine fluvial response to climate, lithology and tectonics (e.g., <a href="http://onlinelibrary.wiley.com/doi/10.1029/WR010i005p00969/abstract">Flint, 1974</a>; <a href="http://onlinelibrary.wiley.com/doi/10.1029/WR025i009p02037/abstract">Tarbonton et al., 1989</a>; <a href="http://geology.gsapubs.org/content/29/5/415.short">Kirby and Whipple 2001</a>; <a href="http://specialpapers.gsapubs.org/content/398/55.full.pdf">Wobus et al., 2006</a>).</p>
</div>
<div class="paragraph">
<p>However, there are limitations with using these plots of slope against drainage area in order to analyse channel profiles.  Topographic data is inherently noisy, either as a result of fine-scale sediment transport processes, or from processing of the data in the creation of DEMs.  Furthermore, this noise is amplified by the derivation of the topographic surface in order to extract values for channel gradient (<a href="http://onlinelibrary.wiley.com/doi/10.1002/esp.3302/abstract">Perron and Royden, 2013</a>).  This noise leads to significant scatter within the profile trends, potentially obscuring any deviations from the power law signal which may represent changes in process, lithology, climate or uplift.  In order to circumvent these problems, more recent studies have turned to the `integral method' of slope-area analysis, which normalises river profiles for their drainage area, allowing comparison of the steepness of channels across basins of different size. The integral method only requires the extraction of elevation and drainage area along the channel, and is therefore less subject to topographic noise than slope-area analysis.  The technique involves integrating equation the stream power equation along the channel, assuming spatially constant incision equal to uplift (steady-state) and erodibility:</p>
</div>
<div class="stemblock">
<div class="content">
\[z(x) = z(x_b) + \Bigg(\frac{E}{K}\Bigg)^{\frac{1}{n}} \int_{x_b}^{x} \frac{dx}{A(x)^{\frac{m}{n}}}\]
</div>
</div>
<div class="paragraph">
<p>where the integration is performed upstream from baselevel (<em>x<sub>b</sub></em>) to a chosen point on the river channel, <em>x</em>.  The profile is then normalised to a reference drainage area (<em>A<sub>0</sub></em>) to ensure the integrand is dimensionless:</p>
</div>
<div class="stemblock">
<div class="content">
\[z(x) = z(x_b) + \Bigg(\frac{U}{K{A_0}^m}\Bigg)^{\frac{1}{n}} \chi\]
</div>
</div>
<div class="paragraph">
<p>where the longitudinal coordinate \(\chi\) is equal to:</p>
</div>
<div class="stemblock">
<div class="content">
\[\chi = \int_{x_b}^{x} \Bigg(\frac{A_0}{A(x)}\Bigg)^{m/n} dx\]
</div>
</div>
<div class="paragraph">
<p>The longitudinal coordinate \(\chi\) has dimensions of length, and is linearly related to the elevation <em>z(x)</em>.  Therefore, if a channel incises based on the stream power incision model, then its profile should be linear on a plot of elevation against \(\chi\). As well as providing a method to test whether channel profiles obey common incision models, \(\chi\)-plots also provide means of testing the appropriate \(\theta\) for a channel (<a href="http://onlinelibrary.wiley.com/doi/10.1002/esp.3302/abstract">Perron and Royden, 2013</a>; <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/full">Mudd et al., 2014</a>).  If the integral analysis is performed for all channels within a basin, the correct value of \(\theta\) can be determined by identifying at which value all of the channels are both linear in \(\chi\)-elevation space, and collinear, where main channel and tributaries all collapse onto a single profile.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_in_these_documents">1.3. What is in these documents</h3>
<div class="paragraph">
<p>This documention contains:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A chapter on getting and installing the software: <a href="#_getting_the_software">Getting the software</a></p>
</li>
<li>
<p>A chapter on preparing your data, mostly with <a href="http://www.gdal.org/">GDAL</a>: <a href="#_preparing_your_data">Preparing your data</a></p>
</li>
<li>
<p>A chapter on the details of running the software, including the options available and the data output formats: <a href="#_running_the_chi_analysis_options_and_outputs">Running the chi analysis: options and outputs</a>. This section rather detailed; if you want specific examples that walk you through analysis go to the following chapter.</p>
</li>
<li>
<p>A brief section on what you need to visualise outputs using out python scripts: <a href="#_visualisation">Visualisation</a></p>
</li>
<li>
<p>A series of example walkthoughs: <a href="#_examples_of_chi_analysis">Examples of chi analysis</a></p>
</li>
<li>
<p>A section on consraining the <em>m/n</em> ratio and channel concavity: <a href="#_calculating_concavity">Calculating concavity</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_the_software">2. Getting the software</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We have attempted, to the best of our ability, to streamline the process of installing our software on any platform (Windows, Linux, MacOS). You will need to install a bit of software. If you have a decent internet connections this should take under an hour. The main rate limiting step is downloading files: You will need to download ~2Gb of software. This requirement is substantially reduced if you want to install on a native Linux machine.</p>
</div>
<div class="sect2">
<h3 id="_starting_up_on_your_own_linux_machine">2.1. Starting up on your own Linux machine</h3>
<div class="paragraph">
<p>If you work on a Linux operating system we have a python script for installing everything. You will need to be connected to the internet, and have python installed. You can skip ahead to the section <a href="#_installing_the_code_and_setting_up_directories">Installing the code and setting up directories</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_starting_up_on_a_non_linux_operating_system_windows_macos">2.2. Starting up on a non-Linux operating system (Windows, MacOS)</h3>
<div class="paragraph">
<p>Below are quick instructions. If you have trouble, follow the link above and then go through the complete instructions.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Quick Instructions for using Vagrant for LSDTopoTools</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install <a href="https://www.virtualbox.org/">virtualbox</a>.</p>
</li>
<li>
<p>Download and install <a href="https://www.vagrantup.com/">vagrant</a>. You might have to restart your computer after this.</p>
</li>
<li>
<p>If you are on Windows, download <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">putty.exe</a>. If you are on Linux or MacOS you can skip this (they have built-in equivalents).</p>
</li>
<li>
<p>Make a directory for your vagrant box. We tend to put ours in a directory called <code>VagrantBoxes</code>.</p>
</li>
<li>
<p>Inside that directory make two new directories: <code>LSDTopoTools</code> and <code>Ubuntu</code>. The second directory&#8217;s name doesn&#8217;t matter, it is just for holding a vagrant file (see below). However you <strong>MUST</strong> have the <code>LSDTopoTools</code> directory. The directory name is <strong>case sensitive</strong>!</p>
</li>
<li>
<p>Download one of our vagrantfiles: <a href="https://github.com/LSDtopotools/LSDTT_vagrantfiles" class="bare">https://github.com/LSDtopotools/LSDTT_vagrantfiles</a> into the <code>Ubuntu</code> directory (again, the name of the directory doesn&#8217;t matter).</p>
</li>
<li>
<p>Rename the vagrantfile from the repo (either <code>Vagrantfile_32bit_FFTW</code> or <code>Vagrantfile_64bit_FFTW</code>) simply <code>vagrantfile</code>. Your operating system is almost certainly 64 bit, but on most computers you need to select 32 bit because the default setting is to disable 64 bit guest operating systems. This can be changed but only by expert users.</p>
</li>
<li>
<p>Open a terminal or powershell window and navigate to the directory with the vagrantfile.</p>
</li>
<li>
<p>Run <code>vagrant up</code> from the command line.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If you are running <code>vagrant up</code> for the first time it can take some time to download the <a href="https://www.vagrantup.com/docs/getting-started/boxes.html">base box</a>. They are several hundred Mb each!
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run <code>vagrant provision</code> after the box has started.</p>
</li>
<li>
<p>If on Windows, you should now be able to use <code>putty.exe</code> to ssh into your LSDTopoTools server. The host name is almost always <code>127.0.0.1</code> and the port is almost always <code>2222</code>.</p>
</li>
<li>
<p>On Windows, you will need to give a username and password after connecting using <code>putty.exe</code>. The machine is running locally on your computer so nothing is being sent over the internet. The username is always <code>vagrant</code>  and the password is also <code>vagrant</code>.</p>
</li>
<li>
<p>If you are on MacOS or Linux you do not need <code>putty.exe</code>; all you need to do is type <code>vagrant ssh</code> into the command line. See the <a href="https://www.vagrantup.com/docs/getting-started/up.html">vagrant instructions</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_troubleshooting_a_vagrant_server">2.3. Troubleshooting a vagrant server</h3>
<div class="paragraph">
<p>There are a few common problems people have when running a vagrant server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you are on an old computer, sometimes vagrant times out before the virtual machine boots. This most frequently happens the first time you boot a vagrant machine. The most effective way to fix this is with the canonical IT solution: turning it off and on again. To do that run <code>vagrant halt</code> and <code>vagrant up</code> in succession.</p>
</li>
<li>
<p>If vagrant hangs up in the powershell or terminal window and does not give you back the command prompt, turn it off and on again by typing ctrl-c and then running the vagrant command again.</p>
</li>
<li>
<p>If your files are not synching across your host and vagrant machine, it is probably because there is some misspelling in your <code>LSDTopoTools</code> folder on the host machine. Make sure that folder is in the correct place and is spelled correctly (remember it should be case sensitive!!).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_installing_the_code_and_setting_up_directories">2.4. Installing the code and setting up directories</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Easy setup quick start</div>
<div class="paragraph">
<p>If you just want to get started with the standard setup without any details, do the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Go into a Linux terminal. If you are on your own computer and it is not Linux, you will need to start a Vagrant session. You will need <a href="https://www.python.org/">python</a> but this is now standard on most Linux distributions so we will assume you have it.</p>
</li>
<li>
<p>If you used our vagrantfile the setup tool will already be on your vagrant box. It is sitting in the LSDTopoTools directory. You can go there with <code>cd /LSDTopoTools</code>.</p>
</li>
<li>
<p>If you are on your own linux machine you can get the setuptool with:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ wget https://raw.githubusercontent.com/LSDtopotools/LSDAutomation/master/LSDTopoToolsSetup.py</code></pre>
</div>
</div>
</li>
<li>
<p>Run the setup tool:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ python LSDTopoToolsSetup.py -id 0 -ChiM True</code></pre>
</div>
</div>
</li>
<li>
<p>You are ready to go!!</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>For native Linux users</strong>: The <code>-id</code> flag tells LSDTopoToolsSetup.py where to put the files. In vagrant it always starts in the root directory (this is for file syncing purposes). However, if your native operating system is Linux, then you can either install in your home directory (<code>-id 0</code>) or in the directory where you called LSDTopoToolsSetup.py (<code>-id 1</code>).
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first thing you need to do is get our python program <strong>LSDTopoToolsSetUp.py</strong>. It lives here: <a href="https://github.com/LSDtopotools/LSDAutomation/blob/master/LSDTopoToolsSetup.py" class="bare">https://github.com/LSDtopotools/LSDAutomation/blob/master/LSDTopoToolsSetup.py</a></p>
<div class="paragraph">
<p>You will need to run this file in your Linux environment, so in a terminal window type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ wget https://raw.githubusercontent.com/LSDtopotools/LSDAutomation/master/LSDTopoToolsSetup.py</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>wget</code> doesn&#8217;t work, you can follow the link:
<a href="https://raw.githubusercontent.com/LSDtopotools/LSDAutomation/master/LSDTopoToolsSetup.py" class="bare">https://raw.githubusercontent.com/LSDtopotools/LSDAutomation/master/LSDTopoToolsSetup.py</a><br>
Copy the text, paste it into a text editor and save it as <code>LSDTopoToolsSetup.py</code>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Now, in your terminal window run this script. It has some options:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>For the most basic setup, type:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ python LSDTopoToolsSetup.py -id 0 -ChiM True</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our Vagrant setup, this will install everything in the root directory (you can got there with <code>$ cd /</code>),  which is the default setup generated by our <a href="https://github.com/LSDtopotools/LSDTT_vagrantfiles">Vagrantfile</a>. If you are not in vagrant the <strong>LSDTopoTools</strong> directories will be in your home directory (you can get there with <code>$ cd ~</code>).</p>
</div>
</li>
<li>
<p>If you don&#8217;t want <strong>LSDTopoTools</strong> in your home directory, you can install it in your current directory with:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ python LSDTopoToolsSetup.py -id 1 -ChiM True</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>It turns out the <code>LSDTopoToolsSetup.py</code> tool has a number of options but we will explain these later. If you want a preview of what it does, you can call its help options:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ python LSDTopoToolsSetup.py -h</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preparing_your_data">3. Preparing your data</h2>
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="title">Essential information about data preparation</div>
<div class="paragraph">
<p>Our software calculates metrics over entire landscapes and along channels, and needs to measure distances and lengths. For this reason the data <strong>must</strong> be in a <a href="https://geonet.esri.com/thread/23160">projected reference system</a>. Because converting data types is nontrivial, we have opted to assume a certain reference system:</p>
</div>
<div class="paragraph">
<p><strong>All your raster data (i.e., your topographic data and subsidiary datasets) need to be in <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">UTM</a> coordinate system.</strong></p>
</div>
<div class="paragraph">
<p>We use <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">the UTM coordinate system</a> since it is a global dataset. However you will need to look up the UTM zone of your data. We use <a href="http://www.dmap.co.uk/utmworld.htm">this map</a> to determine our UTM zone.</p>
</div>
<div class="paragraph">
<p><strong>If you fail to convert to UTM these programs will probably crash!</strong></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_some_data">3.1. Get some data</h3>
<div class="paragraph">
<p>There are many sources of topogaphic data, which we will not repeat here, but if you are looking for an easy interface to get either lidar or SRTM data, we suggest <a href="http://www.opentopography.org/">opentopography</a>. This site is not jst for USA-based lidar but also has very nice interfaces for <a href="http://opentopo.sdsc.edu/lidar?format=sd">global data sets</a>.</p>
</div>
<div class="paragraph">
<p>You can also find a list of freely avaialble lidar datasets at this site:
<a href="https://arheologijaslovenija.blogspot.co.uk/p/blog-page_81.html?spref=tw" class="bare">https://arheologijaslovenija.blogspot.co.uk/p/blog-page_81.html?spref=tw</a></p>
</div>
<div class="paragraph">
<p>Once you download data you will need to convert it into a format and projection suitable for <strong>LSDTopoTools</strong>. If you have <a href="https://en.wikipedia.org/wiki/Raster_data">raster data</a>, the best way to preprocess your data is via <a href="http://www.gdal.org/">GDAL</a>, which is explained inthe section below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_gdal">3.2. Use GDAL</h3>
<div class="paragraph">
<p>When you download topographic data, it will come in all manner of formats, with all manner of coordinate systems. You need to convert the data into <strong>ENVI bil</strong> format and project it into UTM coordinates. You can do all this using <a href="http://www.gdal.org/">GDAL</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<strong>DO NOT</strong> use ESRI bil format! Use <strong>ENVI bil</strong> format. They have similar names but the data format is different!!!
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to convert your rasters to UTM coordinates! If you fail to do this at best the latitude-longitude data in csv files will be in the wrong place, and at worst the program will crash.
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Getting GDAL</div>
<div class="ulist">
<ul>
<li>
<p>If you use our vagrant setup GDAL is already installed. This is appropriate for Windows and MacOS users.</p>
</li>
<li>
<p>If you use Ubuntu, use: <code>sudo apt-get gdal-bin</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">If you don&#8217;t like using command line interface</div>
<div class="paragraph">
<p>All instructions below are based on using a command line interface. If you want to use our tools I am afraid you will need to get used to this. However, <a href="http://www.qgis.org/en/site/">QGIS</a> has GDAL built in so any raster conversions you do in <a href="http://www.qgis.org/en/site/">QGIS</a> will be the same as those listed below. If you use ArcMap there is no telling what you will get but the main thing you will probably get is frozen and/or crashed software. ArcMap is good for a lot of things but this is not one of them.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>If you want to learn all about GDAL you can look at our book: <a href="http://lsdtopotools.github.io/LSDTT_book/#_gdal_2" class="bare">http://lsdtopotools.github.io/LSDTT_book/#_gdal_2</a></p>
</div>
<div class="paragraph">
<p>However, all you really need to use is <strong>gdalwarp</strong>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the folder where your data is sitting (in Linux, e.g. within you vagrant Linux session).</p>
</li>
<li>
<p>Call <strong>gdalwarp</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ gdalwarp -t_srs '+proj=utm +zone=19 +south +datum=WGS84' -of ENVI InputDEM.tif Output_DEM.bil</code></pre>
</div>
</div>
</li>
<li>
<p>The above all contains the essentials:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>-t_srs '+proj=utm +zone=19 +south +datum=WGS84'</code> says you want to project into UTM zone 19 south. Change the "south" and the "zone" accordingly. For example, if you want zone 44 north, use <code>-t_srs '+proj=utm +zone=44 +north +datum=WGS84'</code>.</p>
</li>
<li>
<p><code>-of ENVI</code> means you want ENVI bil format.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If you want to control the spacing of the points, include:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ gdalwarp -t_srs '+proj=utm +zone=19 +south +datum=WGS84' -tr 30 30 -r cubic -of ENVI InputDEM.tif Output_DEM.bil</code></pre>
</div>
</div>
</li>
<li>
<p>In this case the two extra flags are:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>-tr 30 30</code>: Resample to 30 metres in the x any y directions. Change the number for a different resolution.</p>
</li>
<li>
<p><code>-r cubic</code>: This is the resampling method. <strong>DO NOT</strong> use the default; it is nearest neighbour and will result in a striped DEM.</p>
</li>
</ol>
</div>
</li>
<li>
<p>If you want to clip the DEM add <code>-te &lt;x_min&gt; &lt;y_min&gt; &lt;x_max&gt; &lt;y_max&gt;</code> where you put the maximum and minimum extents within the <code>&lt;&gt;</code> symbols.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_stupid_nodata">3.3. Stupid nodata</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Often you get messed up NoData. That is, you get some gigantic number for nodata or the nodata doesn&#8217;t register on the projected DEM. You can attempt to fix this with gdal using the flag <code>dstnodata -9999</code>. However this doesn&#8217;t always work. Luckily, we have programmed some code to try to remove weird numbers, so when you run the code (see the section <a href="#Running the chi analysis">[Running the chi analysis]</a>) you turn the <code>remove_seas</code> switch to true and that should sort you out.</p>
</li>
<li>
<p>Sometimes you get holes in your data. This is annoying. We have code to deal with that, but for now I will just say that you should use the <a href="http://www.opentopography.org/">opentopography</a> data server to get SRTM data as it is seamless. Note that for chi analysis, 30 metre resolution data is probably sufficient: see <a href="http://www.earth-surf-dynam.net/4/627/2016/">Grieve et al, 2016</a> and <a href="http://www.earth-surf-dynam.net/5/211/2017/">Purinton and Bookhagen, 2017</a>.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_chi_analysis_options_and_outputs">4. Running the chi analysis: options and outputs</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section explains the various options and data outputs of the <strong>chi mapping tool</strong>. If you want specific examples of usage you may wish to skip to the section: <a href="#_examples_of_chi_analysis">Examples of chi analysis</a>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Important notes on how vagrant and LSDTopoTools work</div>
<div class="paragraph">
<p>Most users will be running <strong>LSDTopoTools</strong> using <a href="https://www.vagrantup.com/">vagrant</a>. See the section <a href="#_getting_the_software">Getting the software</a> for details.
These are basic notes on running <strong>LSDTopoTools</strong> on a vagrant server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The clever thing about vagrant is that you can run analyses on a Linux machine running inside you host computer (usually Windows or MacOS) but you host computer can see the files.</p>
</li>
<li>
<p><strong>All of our programs are run within the linux server. All data files must be visible to the linux server!</strong></p>
<div class="ulist">
<ul>
<li>
<p>Even though your files are the same files on the host and guest operating system, they have a different address. In Linux the files are in <code>/LSDTopoTools/</code>. In you host operating system they are in the <code>LSDTopoTools</code> folder wherever you put the <code>VagrantBoxes</code> directory.</p>
</li>
</ul>
</div>
</li>
<li>
<p>So in these instructions whenever you see the <code>$</code> prompt it means you are using the guest linux machine, not your hose machine.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>The chi analysis, and a host of other analyses, are run using the <strong>chi_mapping_tool.exe</strong> program. If you followed the instructions in the section <a href="#_getting_the_software">Getting the software</a> you will already have this program compiled.</p>
</div>
<div class="paragraph">
<p>The program <strong>chi_mapping_tool.exe</strong> runs with two inputs when you call the program:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The path to the parameter file. This <strong>MUST</strong> include the trailing slash (i.e., <code>/LSDTopoTools/Topographic_projects/Test_data</code> is incorrect whereas <code>/LSDTopoTools/Topographic_projects/Test_data/</code> is correct).</p>
</li>
<li>
<p>The name of the parameter file.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>So if the parameter file is located at <code>/LSDTopoTools/Topographic_projects/Test_data</code> and it is called <code>test_chi_map.param</code>, you run the program with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ ./chi_mapping_tool.exe /LSDTopoTools/Topographic_projects/Test_data test_chi_map.param</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we will see momentarily, the data and the parameter file can be in different locations, although in general it might be sensible to place the parameter file in the sample directory as the data.</p>
</div>
<div class="paragraph">
<p>The code is run using a parameter file, within which users can set the data they want to print to file. Regardless of which data they choose to print to file, a file will be printed with the extension <code>_Input.param</code> which prints out all the parameters used in the analysis (including the default parameters). This file can be used to verify if the correct parameters have been used in the analysis.</p>
</div>
<div class="sect2">
<h3 id="_text_editors_for_modifying_files">4.1. Text editors for modifying files</h3>
<div class="paragraph">
<p>You will need to modify the parameter file in a text editor. You might also modify python scripts in a text editor. So you need to get a text editor. We use [Brackets] and [Atom] (these are platform independent). Sometimes we also use [PSPad].</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_parameter_file">4.2. The parameter file</h3>
<div class="paragraph">
<p>The parameter file has keywords followed by a value. The format of this file is similar to the files used in the <code>LSDTT_analysis_from_paramfile</code> program, which you can read about in the section <a href="#Running your first analysis">[Running your first analysis]</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The parameter file has a specific format, but the filename can be anything you want. We tend to use the extensions <code>.param</code> and <code>.driver</code> for these files, but you could use the extension <code>.MyDogSpot</code> if that tickled your fancy.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The parameter file has keywords followed by the <code>:</code> character. After that there is a space and the value.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Chi mapping parameter file format</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lines beginning with <code>#</code> are comments.</p>
</li>
<li>
<p>Keywords or phrases are followed by a colon (<code>:</code>).</p>
</li>
<li>
<p>The order of the keywords do not matter.</p>
</li>
<li>
<p>Keywords are not sensitive, but must match expected keywords.</p>
</li>
<li>
<p>If a keyword is not found, a default value is assigned.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_parameter_file_options">4.3. Parameter file options</h3>
<div class="paragraph">
<p>Below are options for the parameter files. Note that all DEMs must be in ENVI <code>bil</code> format (<strong>DO NOT</strong> use ArcMap&#8217;s bil format: these are two different things. See the section <a href="#_preparing_your_data">Preparing your data</a> if you want more details).
The reason we use <code>bil</code> format is because it retains georeferencing which is essential to our file output since many of the files output to <code>csv</code> format with latitude and longitude as coordinates.</p>
</div>
<div class="sect3">
<h4 id="_basic_file_input_and_output">4.3.1. Basic file input and output</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. File input and output options. <strong>These do not have defaults and MUST be declared</strong>.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">write path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path to which data is written. <strong>The code will NOT create a path: you need to make the write path before you start running the program.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path from which data is read.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">write fname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix of rasters to be written <strong>without extension</strong>.
For example if this is <code>Test</code> and you have selected <code>bil</code> format then a fill operation will result in a file called <code>Test_Fill.bil</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">read fname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The filename of the raster to be read without extension. For example if the raster is <code>MyRaster.bil</code>, read fname will be <code>MyRaster</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channel heads fname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The filename of a channel heads file. You can import channel heads. If this is set to <code>NULL</code> then the channels will be calculated using a pixel threshold.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_dem_preprocessing">4.3.2. DEM preprocessing</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. DEM preprocessing. These just help you clean data and perform very basic operations.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum_elevation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have the <code>remove_seas</code> keyword set to true, the program will change any elevation node below this value to NoData.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum_elevation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you have the <code>remove_seas</code> keyword set to true, the program will change any elevation node above this value to NoData.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">remove_seas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, this changes extreme value in the elevation to NoData.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min_slope_for_fill</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum slope between pixels for use in the fill function.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">raster_is_filled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the code assumes the raster is already filled and doesn&#8217;t perform the filling routine. This should save some time in computation, but make sure the raster really is filled or else you will get segmentation faults!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">only_check_parameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, this checks parameter values but doesn&#8217;t run any analyses. Mainly used to see if raster files exist.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_selecting_channels_and_basins">4.3.3. Selecting channels and basins</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. Options for determining which channels and basins to analyse, including settings for the fill function.</caption>
<colgroup>
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 16%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CHeads_file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This reads a channel heads file. It will supercede the <code>threshold_contributing_pixels</code> flag. That is, if you give a valid CHeads filename the code will ignore the threshold pixels and use the sources in the file instead. You can calculate channel heads using our <a href="https://github.com/LSDtopotools/LSDTopoTools_ChannelExtraction">channel extraction tools</a>. The file needs to be a <strong>csv</strong> file and you pass the filename <strong>WITHOUT EXTENSION</strong>. The format of the filename is one with 5 columns: <code>node_index,row,col,x,y</code>. The <code>x,y</code> coordinates are in local UTM coordinates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threshold_contributing_pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of pixels required to generate a channel (i.e., the source threshold).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum_basin_size_pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum number of pixels in a basin for it to be retained. This operation works on the baselevel basins: subbasins within a large basin are retained.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum_basin_size_pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of pixels in a basin for it to be retained. This is only used by <code>find_complete_basins_in_window</code> but that algorithm for selecting basins is the default.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">extend_channel_to_node_before_receiver_junction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, the channel network will extend beyond selected baselevel junctions downstream until it reaches the pixel before the receiver junction. If false, the channel simply extends upstream from the seleced basin. The reason for this switch is because if one if extracting basins by drainage order, then the, say, a 2nd order drainage basin starts at the node immediately upstream of the most upstream 3rd order junction.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">find_complete_basins_in_window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool (true or 1 will work)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>THIS IS THE DEFAULT METHOD! If you don&#8217;t want this method you need to set it to false.</strong> If this is true, it i) Gets all the basins in a DEM and takes thos between the <code>minimum_basin_size_pixels</code> and <code>maximum_basin_size_pixels</code>. It then removes basins that are influenced by the edge of the DEM, and then removes nested basins. The reason for removing basins draining the edge is that all chi and S-A analysis requires that the basin is complete. If not, your area, and therefore chi coordinate, will be incorrect.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">find_largest_complete_basins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool (true or 1 will work)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean that, if set to true, will got through each baselevel node on the edge of the DEM and work upstream to keep the largest basin that is not influenced on its edge by nodata. <strong>This only operates if <code>find_complete_basins_in_window</code> is set to false!</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test_drainage_boundaries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool (true or 1 will work)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean that, if set to true, will eliminate basins with pixels drainage from the edge. This is to get rid of basins that may be truncated by the edge of the DEM (and thus will have incorrect chi values). <strong>This only operates if BOTH <code>find_complete_basins_in_window</code> and <code>find_largest_complete_basins</code> are set to false!, OR if you are using a baselelvel junctions file.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">only_take_largest_basin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool (true or 1 will work)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If this is true, a chi map is created based only upon the largest basin in the raster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_basin_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a raster with the basins. <strong>IMPORTANT!</strong> This should be set to true if you want to use any of our <a href="https://github.com/LSDtopotools/LSDMappingTools">python plotting functions</a> that use basin information. Note that if this is true it will also print csv files with basin numbers and source numbers to assist plotting.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_basic_data_output_before_calculating_chi">4.3.4. Basic data output (before calculating chi)</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. Basic printing operations. For simple rasters and network data that doesn&#8217;t require chi analysis.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">convert_csv_to_geojson</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, this converts any csv file (except for slope-area data) to geojson format. This format takes up much more space than csv (file sizes can be 10x larger) but is georeferenced and can be loaded directly into a GIS. Also useful for webmapping. It assumes your raster is in UTM coordinates, and prints points with latitude and longitude in WGS84.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_raster_without_seas</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a raster that has removed the seas (and very high peaks). This is useful if your NoDataValue is not registering and you use the <code>minimum_elevation</code>, <code>maximum_eleation</code>, and <code>remove_seas</code> flags to correct this. <strong>WARNING!</strong> This overwrites your original raster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_stream_order_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints the stream order raster (but printing this to csv is more efficient, use <code>print_channels_to_csv</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_channels_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the channel network to a csv file. Includes stream order and other useful information. Much more memory efficient than printing the whole raster. It prints <strong>all</strong> channel nodes across the DEM rather than printing nodes upstream of selected basins. <strong>If you want to see the channels selected for chi analysis use <code>print_chi_data_maps</code>.</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_junction_index_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints the junction index raster (but printing this to csv is more efficient, use <code>print_junctions_to_csv</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_junctions_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the junction indices to a csv file. Much more memory efficient than printing the whole raster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_fill_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints the fill raster.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_DrainageArea_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints the drainage area raster (units are m<sup>2</sup>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">write_hillshade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints the hillshade raster. The format of this is stupidly different from other printing calls for a stupid inheritance reason. Try to ignore. Most GIS routines have a hillshading options but for some reason they look crappier than our in-house hillshading. I&#8217;m not sure why but if you want a hillshade I recommend using this function.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_basic_parameters_for_the_chi_coordinate">4.3.5. Basic parameters for the chi coordinate</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. Parameters for calculating the chi coordinate.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A_0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>A<sub>0</sub></em> parameter (which nondimensionalises area) for chi analysis. This is in m<sup>2</sup>. Note that when <em>A<sub>0</sub></em> = 1 then the slope in chi space is the same as the channel steepness index (often denoted by <em>k<sub>s</sub></em>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m_over_n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>m/n</em> parameter (sometimes known as the concavity index) for calculating chi. Note that if you do any <em>m/n</em> analysis (either <code>calculate_MLE_collinearity</code> or <code>print_profiles_fxn_movern_csv</code>) this <em>m/n</em> value will be replaced.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threshold_pixels_for_chi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For most calculations in the <strong>chi_mapping_tool</strong> chi is calculated everywhere, but for some printing operations, such as printing of basic chi maps (<code>print_simple_chi_map_with_basins_to_csv</code>, <code>print_chi_coordinate_raster</code>, <code>print_simple_chi_map_to_csv</code>) you don&#8217;t want chi everywhere (this is especially true when writing a simple csv file) so we have this parameter that sets chi to NoData below these threshold contributing pixels. If this is greater than <code>threshold_contributing_pixels</code> it will default to <code>threshold_contributing_pixels</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">basic_Mchi_regression_nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This works with the basic chi map: segments are not calculated. Instead, a moving window, with a length set by this parameter, is moved over the channel nodes to calculate the chi slope. This method is very similar to methods used to calculate normalised channel steepness (<em>k<sub>sn</sub></em>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_burning_rasters_to_csv">4.3.6. Burning rasters to csv</h4>
<div class="paragraph">
<p>In some circumstances you might want to "burn" secondary data onto your data of the channel network. One example would be if you had a geologic map and wanted to add the rock type as a column to point data about your channels. These routines will take a raster and will add the data values from that raster to each point in the chi data.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
At the moment the burning function only works for the <code>print_chi_data_maps</code> routine.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. Parameters for burning a raster to csv files.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">burn_raster_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, takes raster data and appends it to csv data of channel points.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">burn_raster_prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The prefix of the raster (without the <code>bil</code> extension) that contains the data to be burned. Does not include the directory path. The raster <strong>MUST</strong> be in the same directory as your input DEM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">burn_data_csv_column_header</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">burned_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The column header for your burned data. If you want our python plotting tools to be happy, <strong>do not give this a name with spaces</strong>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_for_exploring_the_em_m_n_em_ratio_with_chi_analysis">4.3.7. Parameters for exploring the <em>m/n</em> ratio with chi analysis</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. Parameters for trying to constrain the <em>m/n</em> ratio using chi analysis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In several of the <em>m/n</em> testing functions, the program starts at this <em>m/n</em> value and then iterates through a number of increasing <em>m/n</em> values, calculating the goodness of fit to each one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delta_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In several of the <em>m/n</em> testing functions, the program increments <em>m/n</em> by this value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In several of the <em>m/n</em> testing functions, the program increments <em>m/n</em> this number of times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">only_use_mainstem_as_reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true this compares the goodness of fit between the mainstem and all tributaries in each basin for each <em>m/n</em> value. If false, it compares <strong>all</strong> tributaries and the main stem to every other tributary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the goodness of fit between tributaries and the main stem. It reports back both MLE and RMSE values. Used to determine <em>m/n</em> ratios. This uses <strong>ALL</strong> nodes in the channel network. The effect is that longer channels have greater influence of the result than small channels.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity_with_points</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the goodness of fit between tributaries and the main stem. It reports back both MLE and RMSE values. Used to determine <em>m/n</em> ratios. It uses specific points on tributaries to conpare the the mainstem. These are located at fixed chi distances upstream of the lower junction of the tributary. The effect is to ensure that all tributaries are weighted similarly in calculating <em>m/n</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity_with_points_MC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the goodness of fit between tributaries and the main stem. It reports back both MLE and RMSE values. Used to determine <em>m/n</em> ratios. It uses specific points on tributaries to conpare the the mainstem. The location of these points is selected at random and this process is reapeated a number of times (the default is 1000) to quantify uncertanty in the best fit <em>m/n</em> ration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collinearity_MLE_sigma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value that scales MLE. It does not afffect which <em>m/n</em> value is the most likeley. However it affects the absolute value of MLE. If it is set too low, MLE values for poorly fit segments will be zero. We have performed sensitivity and found that once all channels have nonzero MLE values the most likely channel does not change. So this should be set high enough to ensure there are nonzero MLE values for all tributaries. Set this too high, however, and all MLE values will be very close to 1 so plotting becomes difficult as the difference between MLE are at many significant digits (e.g., 0.9999997 vs 0.9999996). We have found that a value of 1000 works in most situations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC_point_fractions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the <code>calculate_MLE_collinearity_with_points_MC</code> analysis, this is the number of points on each tributary to test against the main stem channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC_point_iterations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the <code>calculate_MLE_collinearity_with_points_MC</code> analysis, this is the number iterations of drawing random points with which to build best fit <em>m/n</em> statistics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_MC_point_fraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum fraction of the length, in chi, of the main stem that points will be measured over the tributary. For example, if the main stem has a chi lenght of 2 metres, then points on tributaries up to 1 metres from the conluence with the main stem will be tested by the <code>calculate_MLE_collinearity_with_points_MC</code> routine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">movern_residuals_test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the mean residual between the main stem and all the tributary nodes. It is used to search for the <em>m/n</em> value where the residual switches from negative to positive. The rationale is that the correct <em>m/n</em> might be reflected where the mean residual is closest to zero.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_profiles_fxn_movern_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true this loops though every <em>m/n</em> value and prints (to a single csv file) all the chi-elevation profiles. Used to visualise the effect of changing the <em>m/n</em> ratio on the profiles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_movern_analysis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, runs a Monte Carlo Markov Chain analysis of the best fit <em>m/n</em>. First attempts to tune the sigma value for the profuiles to get an MCMC acceptance rate of 25%, then runs a chain to contrain uncertainties. At the moment the tuning doesn&#8217;t seem to be working properly!! This is also extremely computationally expensive, for a, say, 10Mb DEM analysis might last several days on a single CPU core. If you want uncertainty values for the <em>m/n</em> ratio you should use the <code>calculate_MLE_collinearity_with_points_MC</code> routine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_chain_links</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of links in the MCMC chain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_movern_minimum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value of the <em>m/n</em> ratio tested by the MCMC routine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_movern_maximum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of the <em>m/n</em> ratio tested by the MCMC routine.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_for_exploring_the_em_m_n_em_ratio_with_slope_area_analysis">4.3.8. Parameters for exploring the <em>m/n</em> ratio with slope-area analysis</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Parameters for exploring the <em>m/n</em> ratio with slope-area analysis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SA_vertical_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This parameter is used for slope-area analysis. Each channel is traced downslope. A slope (or gradient) is calculated by dividing the fall in the channel elevation over the flow distance; the program aims to calculate the slope at as near to a fixed vertical interval as possible following advice of Wobus et al 2006.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_A_bin_width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is for slope-area analysis. The raw slope-area data is always a horrendous mess. To get something that is remotely sensible you must bin the data. We bin the data in bins of the logarithm of the Area in metres^2. This is the log bin width.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_slope_area_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints the slope-area analysis to a csv file. It includes the raw data and binned data. It is organised by both source and basin so you analyise different channels. See the section on outputs for full details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">segment_slope_area_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, uses the segmentation algorithm in <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/abstract">Mudd et al., JGR-ES 2014</a> to segment the log-binned S-A data for the main stem channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">slope_area_minimum_segment_length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the minimum segment lenght of a fitted segment to the S-A data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap_SA_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This bootstraps S-A data by removing a fraction of the data (set below) in each iteration and calculating the regression coefficients. It is used to estimate uncertainty, but it deosn&#8217;t really work since uncertainty in regression coefficients reduces with more samples and S-A datasets have thousands of samples. Left here as a kind of monument to our futile efforts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N_SA_bootstrap_iterations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of boostrapping iterations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SA_bootstrap_retain_node_prbability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fraction of the data retained in each bootstrapping iteration.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_for_segmentation_of_channels">4.3.9. Parameters for segmentation of channels</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 9. Parameters for calculating the segments of similar chi slope (\(M_{\chi}\)). Details can be found in <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/abstract">Mudd et al., JGR-ES 2014</a>.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_iterations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of iterations of random sampling of the data to construct segments. The sampling probability of individual nodes is determined by the skip parameter. Note that if you want to get a deterministic sampling of the segments you need to set this to 1 and set <code>skip</code> to 0. If you are using Monte Carlo sampling you should set this to at least 20 (but probably not more than 100).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">target_nodes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of nodes in a segment finding routine. Channels are broken into subdomains of around this length and then segmenting occurs on these subdomains. This limit is required because of the computational expense of segmentation, which goes as the factorial (!!!) of the number of nodes. Select between 80-120. A higher number here will take <strong>much</strong> longer to compute.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum_segment_length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum length of a segment in sampled data nodes. The actual length is approximately this parameter times (1+skip). Note that the computational time required goes nonlinearly up the smaller this number. Note that this sets the shortest knickzone you can detect, although the algorithm can detect waterfalls where there is a jump between segments.  It should be between 6-20.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">skip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">During Monte Carlo sampling of the channel network, nodes are sampled by skipping nodes after a sampled node. The skip value is the mean number of skipped nodes after each sampled node. For example, if skip = 1, on average every other node will be sampled. Skip of 0 means every node is sampled (in which case the n_iterations should be set to 1, because there will be no variation in the fit between iterations). If you want Monte Carlo sampling, set between 1 and 4.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sigma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This represents the variability in elevation data (if the DEM has elevation in metres, then this parameter will be in metres). It should include both uncertainty in the elevation data as well as the geomorphic variability: the size of roughness elements, steps, boulders etc in the channel that may lead to a channel profile diverging from a smooth long profile. That is, it is not simply a function of the uncertainty of the DEM, but also a function of topographic roughness so will be greater than the DEM uncertainty.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_nodes_to_visit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The chi map starts with the longest channel in each basin and then works in tributaries in sequence. This parameter determines how many nodes onto a receiver channel you want to go when calculating the chi slope at the bottom of a tributary.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_printing_of_simple_chi_maps">4.3.10. Printing of simple chi maps</h4>
<div class="paragraph">
<p>For most of our visualisation routines, the key printing option to set to <strong>true</strong> is <code>print_chi_data_maps</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 10. Options for printing simple chi maps</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_chi_coordinate_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a raster with the chi coordinate (in m). Note that if you want to control the size of the data symbols in a visualisation, you should select the <code>print_simple_chi_map_to_csv</code> option.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_simple_chi_map_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a csv file with latitude, longitude and the chi coordinate. Can be converted to a GeoJSON with the flag <code>convert_csv_to_geojson</code>. This options gives more flexibility in visualisation than the raster, since in the raster data points will only render as one pixel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_chi_data_maps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>This needs to be true for python visualisation.</strong> If true, prints a raster with latitude, longitude and the chi coordinate, elevation, flow distance, drainage area, source key and baselevel keys to a csv file with the extension <code>_chi_data_map.csv</code>. Many of our <a href="https://github.com/LSDtopotools/LSDMappingTools">visualisation scripts</a> rely on this file.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_chi_maps_with_segmentation_and_basin_and_channel_selection">4.3.11. Chi maps with segmentation and basin and channel selection</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 11. Options for chi maps and secondary data files that split channels and basins</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_simple_chi_map_with_basins_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a csv file with latitude, longitude and the chi coordinate, as well as basin and source information. Can be converted to a GeoJSON with the flag <code>convert_csv_to_geojson</code>. This options gives more flexibility in visualisation than the raster, since in the raster data points will only render as one pixel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_basic_M_chi_map_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a csv file with latitude, longitude and a host of chi information including the chi slope, chi intercept, drainage area, chi coordinate and other features of the drainage network. The \(M_{\chi}\) values are calculated with a rudimentary smoothing window that has a size determined by the parameter <code>basic_Mchi_regression_nodes</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_segmented_M_chi_map_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a csv file with latitude, longitude and a host of chi information including the chi slope, chi intercept, drainage area, chi coordinate and other features of the drainage network. The \(M_{\chi}\) values are calculated with the segmentation algorithm of <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/abstract">Mudd et al. 2014</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_segments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, this gives each segment a unique ID that is written to the <code>segmented_M_chi_map</code> (use <code>print_segmented_M_chi_map_to_csv: true</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_segments_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, this gives each segment a unique ID and prints to raster. <strong>For this to work <code>print_segments</code> must be true.</strong> We use this to map other landscape metrics, such as various hillslope metrics, to channel segments.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_source_keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a csv file that prints the location of all the channel nodes with each of their source keys. The source keys are just the index into the source numbers: it lets you know which tributary each node belongs to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_sources_to_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints as csv that gives information about each of the sources in the DEM. Unless a channel heads csv is provided, these sources will be determined thought a drainage area threshold set by the <code>threshold_contributing_pixels</code> flag (default of 1000 pixels).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_baselevel_keys</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, prints a csv file that prints the location of all the channel nodes with each of their baselelevel keys. The baselevel keys are just the index into the baselevel node (i.e., it tells you to which basin each node is connected).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_for_dealing_with_discharge_rather_than_drainage_area">4.3.12. Parameters for dealing with discharge rather than drainage area</h4>
<div class="paragraph">
<p>These allow the user to drive chi with discharge rather than drainage area. It is somewhat rudimentary at the moment in that it  assumes the rainfall rate in length per time is translated into some constant discharge. This is not a hydrological model! It simply accumulates precipitation through a channel network with no regard to hydrological processes, infiltration and evaporation, or the timing of storms.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 12. Parameters for dealing with precipitation and discharge.</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">precipitation_fname</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NULL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the name (without path or extension) of the precipitation file. There is not much error checking with this file! You <strong>MUST</strong> pass a file that is the same size as the topography raster!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">use_precipitation_raster_for_chi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true, the program will use precipitation to generate a discharge raster and this will be used to calculate chi, rather than drainage area.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_discharge_raster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When true, prints the discharge raster (a convolution of contributing area and precipitation).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_example_parameter_files">4.4. Example parameter files</h3>
<div class="paragraph">
<p>We have a number of example parameter files in the repository <a href="https://github.com/LSDtopotools/LSDTT_chi_examples">LSDTT_chi_examples</a>. The chapter on examples will walk you through the various things these files do.</p>
</div>
</div>
<div class="sect2">
<h3 id="_output_data_formats">4.5. Output data formats</h3>
<div class="paragraph">
<p>Data is written to rasters, csv files, or geojson file.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The rasters are all in ENVI <code>bil</code> format, which you can read about in the section: <a href="#_preparing_your_data">Preparing your data</a>.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
ENVI bil should not be mistaken for ESRI bil. Make sure you are using ENVI bil format.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The <strong>csv</strong> files are comma separated value files which can be read by spreadsheets and GIS software.</p>
<div class="ulist">
<ul>
<li>
<p>If you import csv files into a GIS you need to tell the GIS about the coordinate system.</p>
</li>
<li>
<p>Our csv files all have labeled columns so their contents can be easily views.</p>
</li>
<li>
<p>Almost all of our csv files contain <strong>latitude</strong> and <strong>longitude</strong> columns. These columns are projected into the <strong>WGS84</strong> coordinate system for ease of plotting in GIS software. Select this coordinate system when you loa the csv file into your GIS. For reference it has the <a href="http://spatialreference.org/ref/epsg/wgs-84/">EPSG code 4326</a>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>It is very annoying to have to click buttons in a GIS to select a coordinate system each time you look at csv data, so we also allow you to convert to <a href="http://geojson.org/">geojson</a> format by using the flag <code>convert_csv_to_geojson</code> in the parameter file.</p>
<div class="ulist">
<ul>
<li>
<p>The advantage of these files is that they have georeferencing, so you can load them directly into a GIS or web mapping software.</p>
</li>
<li>
<p>The disadvantage is that they are <strong>HUGE</strong> compared to csv files (usually more than 10x the file size). If you are working within GIS software or using web mapping (e.g., <a href="https://d3js.org/">d3.js</a> or <a href="http://leafletjs.com/">leaflet</a>) you will probably want to generate these files but if you are using our python plotting tools you can probably forgo creating them.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_the_different_outputs_and_how_to_get_them">4.6. The different outputs and how to get them</h3>
<div class="paragraph">
<p>To get the various outputs, you need to tell the <strong>chi mapping tool</strong> using the parameter file. These tables tell you what flags to use and what data you will get.</p>
</div>
<div class="sect3">
<h4 id="_raster_output">4.6.1. Raster output</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 13. These are basic rasters that don&#8217;t require chi analysis.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter file switch</th>
<th class="tableblock halign-left valign-top">Filename contains</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">write hillshade: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_hs.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints a hillshade raster. Seems to give better results than hillshade functions in GIS software. Also much faster. Much of our plotting tools make nice looking maps when you drape hillshade over elevation data so we suggest you turn this on the first time you analyse a landscape.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_fill_raster: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_fill.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints the fill raster. Filling is computationally expensive so you can do this the first time you run a DEM and then use the <code>raster_is_filled</code> flag later to speed up computation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_DrainageArea_raster: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_DArea.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints the drainage area raster. Drainage area is calculated using the <a href="http://www.sciencedirect.com/science/article/pii/S0169555X12004618">Fastscape</a> D8 flow routing algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_basin_raster: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_AllBasins.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints the a basin raster raster. Each basin gets an integer value that is keyed to the baselevel. These correspond to the <code>baselevel_key</code> that appears in csv data files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_chi_coordinate_raster: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_chi_coord.bil</strong> or <strong>_chi_coordQ.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints the chi coordinate. It uses the <em>A<sub>0</sub></em> and <em>m/n</em> values set by the <code>A_0</code> and <code>m_over_n</code> flags in the parameter file (defaults are 1 m<sup>2</sup> and 0.5, respectively). The raster will caculated chi using drainage area, which results in the <strong>_chi_coord.bil</strong> file, unless the switch <code>use_precipitation_raster_for_chi</code> is set to true, in which case a discharge will be calculated from a precipitation raster and this discharge will be used to calculate chi, resulting in a <strong>_chi_coordQ.bil</strong> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_discharge_raster: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_Q.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If <code>use_precipitation_raster_for_chi</code> is set to true, the discharge will be calculated and printed to a raster. Note that there is no real hydrology in this calculation: one should think of it as a number representing the relative supply of water along the channel network. "Discharge" is calculated simply by accumulating the volume of precipitation from each pixel, so precipitation is supplied in m/yr and "discharge" is in m<sup>3</sup>/yr.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_chi_no_discharge: true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>_chi_coord.bil</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used only if you have set <code>use_precipitation_raster_for_chi</code> and <code>print_chi_coordinate_raster</code> to true, and you want a chi coordinate raster that is based on drainage area in addition to one based on discharge. Used for comparison purposes, so you can see how big of a change spatially heterogeneous precipitation causes to the chi coordinate.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_point_data_usually_output_as_csv">4.6.2. Point data (usually output as csv)</h4>
<div class="paragraph">
<p>The table below gives a brief description of the output files. After the table we show the format for each of these files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the <code>convert_csv_to_geojson</code> flag is set to <code>true</code> then the csv data headers will be recast as geojson point attributes.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 14. Point data avaiable in csv or geojson format. Switch to true to turn on.</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">parameter file switch, and the filename will contain</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Data columns</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_channels_to_csv
</p><p class="tableblock"><strong>_CN.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the channel network to csv.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,Junction Index,Stream Order,NI</em>
</p><p class="tableblock"><em>NI</em> is the node index (an index into individual pixels in the DEM), and <em>Junction Index</em> is an index into the <code>LSDJunctionNetwork</code> object. Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_junctions_to_csv
</p><p class="tableblock"><strong>_JN.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints junction numbers to csv.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>junction,node,x,y,latitude,longitude,stream_order</em>
</p><p class="tableblock"><em>junction</em> is the junction index. Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, whereas <em>x</em> and <em>y</em> are in the local UTM coordinates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_sources_to_csv
</p><p class="tableblock"><strong>_ATsources.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints the sources to csv.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>node,x,y,latitude,longitude</em>
</p><p class="tableblock"><em>node</em> is the node index from <code>LSDFlowInfo</code>. Latitude and longitude are in WGS84, whereas <em>x</em> and <em>y</em> are in the local UTM coordinates.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_simple_chi_map_to_csv
</p><p class="tableblock"><strong>_chi_coord.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints a very basic chi map.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,chi</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, chi is in metres.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_simple_chi_map_with_basins_to_csv
</p><p class="tableblock"><strong>_chi_coord_basins.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prints a very basic chi map, but includes the basin.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,chi,basin_junction</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, chi is in metres. The <em>basin_junction</em> refers to the junction number of the baselevel junction for each node. Allows one to plot these profiles by basin.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_basic_M_chi_map_to_csv
</p><p class="tableblock"><strong>_MChiBasic.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a very rudimentary version of a map of chi slope (if <em>A<sub>0</sub></em> = 1, then this is the same as the channel steepness index). No segmentation is performed, it simply calculates chi slope from smoothed profiles.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,chi,elevation,flow distance,drainage area,m_chi,b_chi,source_key,basin_key</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, chi and flow distance are in metres. Drainage area is in m<sup>2</sup>. <em>M_chi</em> is the slope in chi space, equivalent to <em>k<sub>sn</sub></em> if <em>A<sub>0</sub></em> is set to 1. <em>b_chi</em> is the intercept of the chi segment. The <em>source_key</em> and <em>basin_key</em> are indices into the basins and sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_segmented_M_chi_map_to_csv
</p><p class="tableblock"><strong>_MChiSegmented.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This uses segmentation to calculate chi slopes (if <em>A<sub>0</sub></em> = 1, then this is the same as the channel steepness index) following the <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/full">Mudd et al, 2014</a> algorithms.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,chi,elevation,flow distance,drainage area,m_chi,b_chi,source_key,basin_key</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, chi and flow distance are in metres. Drainage area is in m<sup>2</sup>. <em>M_chi</em> is the slope in chi space, equivalent to <em>k<sub>sn</sub></em> if <em>A<sub>0</sub></em> is set to 1. <em>b_chi</em> is the intercept of the chi segment. The <em>source_key</em> and <em>basin_key</em> are indices into the basins and sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_segments
</p><p class="tableblock"><strong>_MChiSegmented.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This uses segmentation to calculate chi slopes (if <em>A<sub>0</sub></em> = 1, then this is the same as the channel steepness index) following the <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/full">Mudd et al, 2014</a> algorithms. It includes the segment data including a segment number and the fitted segment elevation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,chi,elevation,flow distance,drainage area,m_chi,b_chi,source_key,basin_key,segmented_elevation,segment_number</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, chi and flow distance are in metres. Drainage area is in m<sup>2</sup>. <em>M_chi</em> is the slope in chi space, equivalent to <em>k<sub>sn</sub></em> if <em>A<sub>0</sub></em> is set to 1. <em>b_chi</em> is the intercept of the chi segment. The <em>source_key</em> and <em>basin_key</em> are indices into the basins and sources. The <em>segmented_elevation</em> is the elevation of the segment, and the <em>segment_number</em> is an increasing integer for each segment. The segment number is used to search for knickpoints if <code>skip</code> is set to 0 and <code>n_iterations</code> is set to 1.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">check_chi_maps
</p><p class="tableblock"><strong>_checkchi.csv</strong> and <strong>_checkchiQ.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is used with the discharge-based chi calculation to compare chi values using discharge (<code>_checkchiQ.csv</code>) vs drainage area (<code>_checkchi.csv</code>).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,chi,elevation,flow distance,drainage area,source_key,basin_key</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>, chi and flow distance are in metres. Drainage area is in m<sup>2</sup>. The <em>source_key</em> and <em>basin_key</em> are indices into the basins and sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_source_keys
</p><p class="tableblock"><strong>_SourceKeys.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints information about source keys for each node in the channel network. Allows visualisation tools to link nodes to their sources, and thus used to plot tributaries.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,source_node,source_key</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>. The <em>source_node</em> is the node id of the source from the <code>LSDFlowInfo</code> object and the <em>source_key</em> is a key of the source (used so that sources are numbered 0,1,2,3, etc. instead of some random large integer).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_baselevel_keys
</p><p class="tableblock"><strong>_BaselevelKeys.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints information about baselevel keys for each node in the channel network. Allows visualisation tools to link nodes to their baselevel, and thus used to plot basins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>latitude,longitude,baselevel_node,baselevel_junction,baselevel_key</em>
</p><p class="tableblock">Latitude and longitude are in <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a>. The <em>baselevel_node</em> is the node id of the source from the <code>LSDFlowInfo</code> object. The <em>baselevel_junction</em> is the junction index from the <code>LSDJunctionIndex</code> object, and the <em>baselelvel_key</em> is a key of the baselevel (used so that basins are numbered 0,1,2,3, etc. instead of some random large integer).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_profiles_fxn_movern_csv
</p><p class="tableblock"><strong>_movernQ.csv</strong> or <strong>_movern.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loops through <em>m/n</em> values and records the chi coordinate for all the channels for each <em>m/n</em>. If <code>use_precipitation_raster_for_chi</code> is true then this prints a <strong>_movernQ.csv</strong>, and prints <strong>_movern.csv</strong> otherwise.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>source_key,basin_key,elevation,m_over_n = 0.2, m_over_n = 0.3, etc.</em>
</p><p class="tableblock">The <em>source_key</em> and <em>basin_key</em> are indices into the basins and sources. <em>elevation</em> is the, wait for it, elevation. Following this there are columns of the chi coordinate for each <em>m/n</em> value, which are determined by the parameters <code>n_movern</code>, <code>start_movern</code>, and <code>delta_movern</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity
</p><p class="tableblock"><strong>_movernstats</strong> or <strong>_movernstatsQ</strong> with <strong>_basinstats.csv</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loops through <em>m/n</em> values and records  the goodness of fit between tributaries and main stem for all the channels for each <em>m/n</em>. If <code>use_precipitation_raster_for_chi</code> is true then this prints <strong><em>movernstatsQ</em></strong> files, and prints <strong><em>movernstats</em></strong> otherwise. Generates a large number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>basin_key,m_over_n = 0.2, m_over_n = 0.3, etc.</em>
</p><p class="tableblock">The  <em>basin_key</em> is and index into the basins and sources. <em>elevation</em> is the, wait for it, elevation. Following this there are columns of the maximum likelihood estimator (MLE) for each basin for each <em>m/n</em> value, which are determined by the parameters <code>n_movern</code>, <code>start_movern</code>, and <code>delta_movern</code>. The higher the MLE, the better the fit. Calculated by projecting each tributary data point onto a linear fit between adjacent nodes in chi-elevation space of the main stem channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity
</p><p class="tableblock"><strong><em>movernstats</strong> or <strong>_movernstatsQ</strong> with <strong>_X_fullstats.csv</strong> where <strong>X</strong> is _m/n</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Loops through <em>m/n</em> values and records  the goodness of fit between tributaries and main stem for all the channels for each <em>m/n</em>. These are separate files for each <em>m/n</em> value (denoted in the filename). If <code>use_precipitation_raster_for_chi</code> is true then this prints <strong><em>movernstatsQ</em></strong> files, and prints <strong><em>movernstats</em></strong> otherwise. Generates a large number of files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reference_source_key,test_source_key,MLE,RMSE</em>
</p><p class="tableblock">The <em>reference_source_key</em> is key of the channel that serves as a reference, against which goodness of fit will be measured. The <em>test_source_key</em> is the source key of the tributary which is being compared to the reference channel. The <em>MLE</em> is the maximum likelihood estimator, where better goodness of fit results in higher numbers, and the <em>RMSE</em> is the root mean square error, where smaller numbers indicate a better fit.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_visualisation">5. Visualisation</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>LSDTopoTools</strong> produces two main data types: raster data and point data.
This chapter is a brief overview of ways to visualise these datasets. We go through some examples in the next chapter.</p>
</div>
<div class="sect2">
<h3 id="_using_a_gis">5.1. Using a GIS</h3>
<div class="ulist">
<ul>
<li>
<p>Raster data is output in ENVI bil format, which can be read by standard GIS software such as <a href="http://www.qgis.org/en/site/">QGIS</a> or <a href="https://www.arcgis.com/features/index.html">ArcMap</a>.</p>
</li>
<li>
<p>Point data is output as <a href="https://en.wikipedia.org/wiki/Comma-separated_values">csv</a> files. You can also choose to output these data as <a href="http://geojson.org/">geojson</a> files.</p>
<div class="ulist">
<ul>
<li>
<p>To load csv files into a GIS, you will need to import them. Here are instructions <a href="http://www.qgistutorials.com/en/docs/importing_spreadsheets_csv.html">for QGIS</a> and for <a href="http://support.esri.com/technical-article/000012745">ArcMap</a>. In both cases you will need to tell your GIS what coordinate system the data is in. <strong>LSDTopoTools</strong> writes latitude and longitude to our csv files in the <a href="http://spatialreference.org/ref/epsg/wgs-84/">WGS84</a> geographic coordinate system.</p>
</li>
<li>
<p>Geojson files are <strong>huge</strong> compared to csv files but they can be used for web mapping (e.g., <a href="https://d3js.org/">D3.js</a> or <a href="http://leafletjs.com/">leaflet</a>), and they are georeferences socan be loaded directly into a GIS using the "add vector data" functionality.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_python">5.2. Using python</h3>
<div class="paragraph">
<p>We have a number of visualisation scripts built using <a href="https://www.python.org/">python</a> and its packages <a href="http://www.numpy.org/">numpy</a>, <a href="http://pandas.pydata.org/">pandas</a>, and <a href="https://matplotlib.org/">matplotlib</a>.</p>
</div>
<div class="sect3">
<h4 id="_setting_up_python">5.2.1. Setting up Python</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Do not set up python in a vagrant server. Instead do it in your host operating system. The vagrant server is a stripped down version of Linux that cannot generate windows so you can have only limited functionality of these tools in a vagrant server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is a quick guide. There are many options for setting up python but this is our preferred setup.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The best way to install python is <a href="http://conda.pydata.org/miniconda.html">miniconda</a>. Currently everything we use is tested on <strong>Python 2.7</strong>, so use the Python 2.7 installer. However, we have attempted to maintain compatibility to python 3.x. If you use that, it should be okay, but please report any bugs on the github page.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Our visualisation routines involve some computation, and dealing with geospatial data. This means that there are a numer of packages to install. This might take some time. If you are already using python for something critical you may consider setting up a <a href="https://realpython.com/blog/python/python-virtual-environments-a-primer/">virtual</a> <a href="http://python-guide-pt-br.readthedocs.io/en/latest/dev/virtualenvs/">environment</a> to ensure all of these new packages don&#8217;t break what you&#8217;ve already got.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Once you have installed  <a href="http://conda.pydata.org/miniconda.html">miniconda</a>, you can go into a command prompt (windows) or terminal (MacOS and Linux) and get the other stuff you need. To get the command prompt in windows look for the <strong>cmd.exe</strong> program.</p>
</li>
<li>
<p>You sould create a python environment for <strong>LSDTopoTools</strong>. Read about <a href="https://conda.io/docs/user-guide/tasks/manage-environments.html">conda python environemts here</a>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">&gt; conda config --add channels conda-forge
&gt; conda create --name LSDTT
&gt; conda install -n LSDTT shapely
&gt; conda install -n LSDTT fiona
&gt; conda install -n LSDTT rasterio
&gt; conda install -n LSDTT scipy
&gt; conda install -n LSDTT matplotlib
&gt; conda install -n LSDTT pandas
&gt; conda install -n LSDTT gdal
&gt; conda install -n LSDTT pyproj
&gt; conda install -n LSDTT descartes
&gt; conda install -n LSDTT spyder
&gt; conda activate LSDTT</code></pre>
</div>
</div>
</li>
<li>
<p>Every time you use our tools, you should activate the <strong>LSDTT</strong> python environment.</p>
</li>
<li>
<p>To run spyder you just type <code>spyder</code> at the command line.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Spyder needs an older version of a package called <strong>PyQt</strong>. If spyder doesn&#8217;t start correctly, run <code>conda install pyqt=4.10 -f</code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is entirely possible that we have forgotten some package, but if you run one of our scripts and it tells you the package is not found, just use <code>conda</code> to install.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_setting_up_python_using_a_conda_virtual_environment">5.2.2. Setting up python using a conda virtual environment</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is an alternative to the previous section!
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install <a href="http://conda.pydata.org/miniconda.html">miniconda</a> on your host machine.</p>
</li>
<li>
<p>Open a command prompt (use the start menu to search for <strong>cmd.exe</strong>)</p>
</li>
<li>
<p>Get our  <a href="https://raw.githubusercontent.com/LSDtopotools/LSDMappingTools/a1e4bd94911afc25a10ed2482553736bc2ce8894/environment.yml">environment file</a>.</p>
</li>
<li>
<p>Create the environment from that file with:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">&gt; conda env create -f environment.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;m afraid this will take a little while.</p>
</div>
</li>
<li>
<p>Activate the environment:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">&gt; activate LSDTT</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This environment does not include <strong>spyder</strong>, you can install it with <code>conda install -n LSDTT spyder</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_spyder">5.2.3. Using Spyder</h4>
<div class="paragraph">
<p>Once you have installed python, you can use it from the command line (i.e. from a powershell or terminal window). However, you might prefer using a nice development environment that checks your code and has pretty colours and reassuring windows. When we are not using text editors (see our section <a href="#_text_editors_for_modifying_files">Text editors for modifying files</a>) we tend to use Spyder, which has an editor that can give you help with python packages and highlight your mistakes. You should have already installed it with <code>conda install spyder</code>, so to get it running go into a powershell or terminal window and just type:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">&gt; spyder</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You cannot run spyder on the vagrant machine since it has no windowing system. If you want to run <strong>Spyder</strong> you need to use your host operating system. This is the one of the reasons we encourage you to do your python installation on your host operating system and not the vagrant machine.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_getting_our_plotting_tools">5.2.4. Getting our plotting tools</h4>
<div class="paragraph">
<p>Our vagrant setup has no graphic interface (you only interact with it through a terminal) so we suggest using your host operating system for python.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>You need to clone our repository <a href="https://github.com/LSDtopotools/LSDMappingTools">LSDMappingTools</a>.</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
At the moment <a href="https://github.com/LSDtopotools/LSDMappingTools">LSDMappingTools</a> is a complete mess. It currently serves as a bit of a sandbox for visualisation development. One day we will clean it all up and make a nice, pretty release. But for now I&#8217;m afraid you&#8217;ll need to rely on this repository.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>If you don&#8217;t want to install <a href="https://git-scm.com/">git</a> on your host operating system, you can clone the repository from your vagrant machine. Becase of the clever way vagrant works you will be able to use these files in you host operating system.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /LSDTopoTools/Git_projects
$ git clone https://github.com/LSDtopotools/LSDMappingTools.git</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In your host operating system these files will not be in <code>/LSDTopoTools/Git_projects</code>. They will be within the <code>VagrantBoxes\LSDTopoTools\Git_projects</code> directory (wherever you put it. On windows I put mine in the <code>C</code> directory).
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Once you have this repository you can move on to our examples in the next chapter.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_fixing_python_gdal_in_windows">5.2.5. Fixing python gdal in windows</h4>
<div class="paragraph">
<p>If you are using windows, there is a stupid bug in the <strong>conda</strong> gdal package where it cannot find the gdal data. To fix this:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Search for the file <strong>gcs.csv</strong>. Note the folder in which it is located. On my system it is in <code>C:\Miniconda2\Library\share\gdal</code></p>
</li>
<li>
<p>Go into the control panel, go to system (or system and security, then system), click on <strong>advanced system settings</strong> and in system variables enter a new variable: <strong>GDAL_DATA</strong>. For the value of this enter the directory where the gdal data is that you fond above.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examples_of_chi_analysis">6. Examples of chi analysis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will now run some examples of chi analysis using the the <strong>chi mapping tool</strong>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
We are going to assume you are using our vagrant setup. That means that code will live in the directory <code>/LSDTopoTools/Git_projects/LSDTopoTool_ChiMudd2014</code> and topographic data will live in the directory <code>/LSDTopoTools/Topographic_projects</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_get_the_example_data">6.1. Get the example data</h3>
<div class="paragraph">
<p>We have placed several example datasets in the github repository <a href="https://github.com/LSDtopotools/LSDTT_chi_examples">LSDTT_chi_examples</a>. You can clone these in your vagrant box into the <code>Topographic_projects</code> folder:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /LSDTopoTools/Topographic_projects
$ git clone https://github.com/LSDtopotools/LSDTT_chi_examples.git</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_first_example_basic_dem_steps_and_basin_selection">6.2. First example: Basic DEM steps and Basin selection</h3>
<div class="paragraph">
<p>First we will do some very basic extraction of basins and visualisation of a region near Xi&#8217;an China, in the mountains containing <a href="https://en.wikipedia.org/wiki/Mount_Hua">Hua Shan</a>.</p>
</div>
<div class="paragraph">
<p>If you have followed the steps in the section: <a href="#_getting_the_software">Getting the software</a>, the <strong>chi mapping tool</strong> will already be installed, and the example driver file will be in the <code>LSDTT_chi_examples</code> folder.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the directory with the <strong>chi mapping tool</strong>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /LSDTopoTools/Git_projects/LSDTopoTool_ChiMudd2014/driver_functions_MuddChi2014/</code></pre>
</div>
</div>
</li>
<li>
<p>Now run the example driver file.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ ./chi_mapping_tool.exe /LSDTopoTools/Topographic_projects/LSDTT_chi_examples Xian_example1.driver</code></pre>
</div>
</div>
<div class="paragraph">
<p>In every <strong>LSDTopoTools</strong> analysis in these examples, there are three inputs: i) the name of the program (<code>./chi_mapping_tool.exe</code>) ii) the directory of the data (<code>/LSDTopoTools/Topographic_projects/LSDTT_chi_examples</code>) and iii) the name of the driver file (<code>Xian_example1.driver</code>). The extension of the driver file doesn&#8217;t matter, you could call it <code>Xian_example1.rhinocerous</code> if you wanted.</p>
</div>
</li>
<li>
<p>The important elements of the driver file are:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><code>test_drainage_boundaries: true</code> This is actually the default. We put it in the parameter file here to highlight its importance. The chi coordinate is calculated integrating drainage area along the channel so if your basin is truncated by the edge of the DEM it means that <strong>your chi coordinate will be incorrect</strong>.</p>
</li>
<li>
<p><code>write hillshade: true</code>. Does what is says on the tin. It means that you will print a hillshade raster. You really need to do this the first time you analyse a DEM (but you only need to do it once). The reason is that all your figures will look much nicer with a hillshade!</p>
</li>
</ol>
</div>
</li>
<li>
<p>We are going to visualise the output using python.</p>
</li>
<li>
<p>In your host operating system, find the directory that contains the <a href="https://github.com/LSDtopotools/LSDMappingTools">LSDMappingTools</a> directory.</p>
</li>
<li>
<p>You might want to open spyder (see the section: <a href="#_getting_our_plotting_tools">Getting our plotting tools</a> on how to get this) to look at the python script. To open spyder simply type <code>spyder</code> into a powershell window (Windows)  or terminal (Linux/MaxOS).</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_some_comments_on_basin_selection">6.2.1. Some comments on basin selection</h4>
<div class="paragraph">
<p>In the <strong>chi mapping tool</strong>, we have several ways to select basins. We feel the default method is best (<code>find_complete_basins_in_window</code>). The options are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>find_complete_basins_in_window</code>: This goes through several refining steps. If first checks every basin in the raster and selects basins within a size window between <code>minimum_basin_size_pixels</code> and <code>maximum_basin_size_pixels</code>. It then takes the resulting list of basins and removes any that are influenced by the edge of the DEM (to ensure drainage area of the basin is correct). Finally, it removes nested basins, so that in the end you have basins of approxamaitely the same size, not influenced by the edge of the DEM, and with no nested basins.</p>
</li>
<li>
<p><code>find_largest_complete_basins</code>: This is a somewhat old version that takes all basins draining to edge and works upstream from their outlets to find the largest subbasin that is not influenced by the edge. To get this to work you <strong>MUST ALSO</strong> set <code>find_complete_basins_in_window: false</code>.</p>
</li>
<li>
<p><code>test_drainage_boundaries</code>: If either <code>find_complete_basins_in_window</code> or <code>find_largest_complete_basins</code> are <code>true</code> then this is ignored. If not, then it eliminates any basin that is influenced by the edge of the DEM.</p>
</li>
<li>
<p><code>BaselevelJunctions_file</code>: If this points to a file that includes a series of integers that refer to junction indices, it will load these indices. If the file doesn&#8217;t contain a series of integers the most likely result is that it will crash!</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_our_example_scripts">6.3. Using our example scripts</h3>
<div class="paragraph">
<p>Okay, lets look at some of the results. I would suggest opening <strong>Spyder</strong> in your host operating system for this.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In spyder, use <strong>file&#8594;open</strong> to open the plotting script for our examples called, innovatively, <code>ChiMappingExamples.py</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>In your vagrant box this file is in <code>/LSDTopoTools/Git_projects/LSDMappingTools</code>.</p>
</li>
<li>
<p>In windows, if you have put your vagrant stuff in <code>C:\VagrantBoxes</code> then this file is in <code>C:\VagrantBoxes\LSDTopoTools\Git_projects\LSDMappingTools</code>.</p>
</li>
<li>
<p>In MacOS it will be wherever you put the VagrantBoxes folder and then in <code>/LSDTopoTools/Git_projects/LSDMappingTools</code>.</p>
</li>
<li>
<p>You can run these scripts in your vagrant machine, but you will have to do the full python install there, and in addtion you won&#8217;t be able to use any graphical interface (like <strong>spyder</strong>) so our recomendation is for you to run visualisation scripts in your host operating system.</p>
<div class="paragraph">
<p>+ In python, any lines between two blocks of <code>"""</code> symbols is a comment. In our program we put notes between these symbols. Don&#8217;t change them. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">    """
    These lines tell the example functions where your files are. If you are using
    the recommended file setup you won't need to modify these lines.

    If you have set up your own directory structure you will need to modify
    the directory names.
    """</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above lines just give you instructions.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>In python, you can also make a line a comment with the <code><mark></code> symbol. In these excercises you can uncomment lines by deleteing the <code></mark></code> symbol, and adding it back in again. Initially all but the first part of the first example is turned off:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">    CME.ExampleOne_PartOne_SimpleHillshade(DataDirectory,Base_file)
    #CME.ExampleOne_PartTwo_PrintBasins(DataDirectory,Base_file)
    #CME.ExampleOne_PartThree_PrintBasinsWithLabels(DataDirectory,Base_file)</code></pre>
</div>
</div>
</li>
<li>
<p>To turn off example part one and turn on part two do this:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">    #CME.ExampleOne_PartOne_SimpleHillshade(DataDirectory,Base_file)
    CME.ExampleOne_PartTwo_PrintBasins(DataDirectory,Base_file)
    #CME.ExampleOne_PartThree_PrintBasinsWithLabels(DataDirectory,Base_file)</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_visualising_example_one_data">6.4. Visualising example one data</h3>
<div class="paragraph">
<p>We will now generate some figures to look at our data.</p>
</div>
<div class="sect3">
<h4 id="_example_one_part_one_the_hillshade">6.4.1. Example one, part one: the hillshade</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Make sure you&#8217;ve run the <strong>chi mapping tool</strong> first: <a href="#_first_example_basic_dem_steps_and_basin_selection">First example: Basic DEM steps and Basin selection</a>.</p>
</li>
<li>
<p>In <strong>spyder</strong> run the <code>ChiMappingExamples.py</code> with the first example turned on (i.e., no <code>#</code> in front of <code>CME.ExampleOne_PartOne_SimpleHillshade(DataDirectory,Base_file)</code>).</p>
</li>
<li>
<p>This will create a png of this example DEM in your data folder called <strong>Xian_example1.png</strong></p>
</li>
<li>
<p>If you look at the code for this example (in <code>ChiVisualisation_Example01.py</code>) you should see a few basic options. You can change the figure size, the location of the colourbar, various labels, as well as the resolution of the figure (using the <code>dpi</code> keyword). The default format is <strong>png</strong> buy you can change that in the <code>MF.save_fig</code> command with <code>figure_format = "pdf"</code> (for example). We encourage you to play with the options to see what they do.</p>
<div class="imageblock">
<div class="content">
<img src="images/Xian_example1.png" alt="Area around Mount_Hua">
</div>
<div class="title">Figure 1. A hillshade of the example landscape</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_example_one_part_two_coloured_basins">6.4.2. Example one, part two: coloured basins</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Next turn on the second part of the example (<code>CME.ExampleOne_PartTwo_PrintBasins(DataDirectory,Base_file)</code>). This will show you the basins that have been algorithmically extracted:</p>
<div class="imageblock">
<div class="content">
<img src="images/Xian_coloured_basins.png" alt="Basins around Mount_Hua">
</div>
<div class="title">Figure 2. The extracted basins, coloured by basin number</div>
</div>
</li>
<li>
<p>We have added a few more lines in this example script to show more options. For example you can change the colourmap (<code>cmap = plt.cm.jet</code>, but you could change to <code>cmap = plt.cm.cubehelix</code> for example), and later there are some options for the basin outlines.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_example_one_part_three_numbered_basins">6.4.3. Example one, part three: numbered basins</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Figuring out the basin numbers using a colourbar is inconvineint. If you turn on the third part of the example you will see text labels for each basin:</p>
<div class="imageblock">
<div class="content">
<img src="images/Xian_basin_keys.png" alt="Numbered basins around Mount_Hua">
</div>
<div class="title">Figure 3. The extracted basins</div>
</div>
</li>
<li>
<p>So now we have basin numbers.</p>
</li>
<li>
<p>You might notice that the basin numbers are somewhat randomly distributed. This is because we use a <a href="http://www.sciencedirect.com/science/article/pii/S0169555X12004618">very efficient algorithm</a> to compute the flow network and this algorithm does the numbering for us based on the connectivity of basins in the raster. To make this numbering more sensible to a human we need to manually rename them.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_example_one_part_four_renaming_basins">6.4.4. Example one, part four: renaming basins</h4>

</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_calculating_concavity">7. Calculating concavity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section you will find instructions on using the <strong>chi mapping tool</strong> to calculate channel concavity. What is channel concavity? If you look at typical channels, you will find steep headwaters but as you move downstream the channels will become gentler. Authors in the middle of the twentieth century began to calculate channel slope as one moved downstream and found sysematic relasionships between drainage area, <em>A</em> and channel slope, <em>S</em>, finding that the relasionship could be described with \(S = k_s A^{-\theta}\). This relasionship is often called Flint&#8217;s law, after a 1975 paper. The exponent, \(\theta\), is called the concavity because it describes how concave the channel is: if the channel profile has little variation in slope downstream the channel has a low concavity.</p>
</div>
<div class="paragraph">
<p>A number of models have been proposed for channel incision into bedrock, and a number of these models describe erosion as some funciton of slope and drainage area, and in the simplist version of these family of models, called stream power models, the concavity is related to the slope and area exponents, where erosion rate is modelled as \(E = k A^m S^n\) and if uplift is balanced by erosion the predicted topographic outcome is \(\theta = m/n\). There is much debate about the appropriateness of these simple models but it is probably not controversial to say that most geomorphologists believe the concavity refelcts the transport and erosion processes taking place within upland river.</p>
</div>
<div class="paragraph">
<p>In addition, a number of authors have used channel steepness to infer either erosion and uplift rates across river networks, and these calculations often involve computing the channel concavity. This can be done in a number of ways. We at <strong>LSDTopoTools</strong> have included a number of methods, both traditional and newly developed, for the purpose of computing the channel concavity in river networks. In this section you will find instructions for using our tools.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
In this documentation, you will find references to <em>concavity</em> or \(\theta\) and the \(m/n\) ratio. The concavity, \(\theta\), is a purely geometric relasionship between channel slope and drainage area. On the other hand \(m/n\) is derived from stream power and therefore includes some assumptions about the incision model. Because chi (\(\chi\)) can be calculated by assuing an \(m/n\) ratio using topographic data, it also describes slope-area relasionships, but chi analysis is more closely linked to incision models than concavity. Because most of our methods use chi analysis, we use typicaly state that our methods search for the most likely \(m/n\) ratio rather than the most likeley concavity.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_before_you_start">7.1. Before you start</h3>
<div class="paragraph">
<p>Before you start, make sure you have
* Set up <strong>LSDTopoTools</strong> and compiled. Follow the instructions here: <a href="#_getting_the_software">Getting the software</a>
* Install the appropriate python packages. Follow the instructions here: <a href="#_setting_up_python">Setting up Python</a>
* Make sure your data is in the correct format (i.e., WG1984 UTM projection, ENVI bil format). Follow instructions here: <a href="#_preparing_your_data">Preparing your data</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_options_you_need_for_calculating_the_most_likely_concavity">7.2. Options you need for calculating the most likely concavity</h3>
<div class="paragraph">
<p>For these analyses you will use our multi-purpose channel analysis package: the <strong>chi mapping tool</strong>. We will assume you have already compiled the tool and know how to direct it to your data using the <em>driver file</em>. If you don&#8217;t know about those things you&#8217;ll need to go back a few chapters in this documentation.</p>
</div>
<div class="paragraph">
<p>The good news is that we have automated the computations with a single switch in the driver function. In the driver file, you just need the option <code>estimate_best_fit_movern: true</code>.
However, there are a few more options that are important in generating sensible output for the analysis</p>
</div>
<div class="sect3">
<h4 id="_some_key_options">7.2.1. Some key options</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 15. Main options for performing a concavity or <em>m/n</em> analysis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">estimate_best_fit_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You need to switch this to <code>true</code> to perform all the analysis for channel concavity or <em>m/n</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collinearity_MLE_sigma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a scaling factor for our maximum likelihood estimator (MLE). In our paper we demonstrate how this is simply a constant that can be removed from MLE calculations, so supervifically its value doesn&#8217;t matter. However, if this value is low, then the MLE values will be zero and you will not get reliable results. If you are getting estimates of <em>m/n</em> that are very low, it might be because sigma is too low. If this is the case you should increase sigma until the best fit values of <em>m/n</em> do not change. <strong>In most cases you can use the default but if you have very large networks you may need to increase this parameter</strong>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threshold_contributing_pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the minimum number of contributing pixels to form a channel. Lower values will result in denser channel networks.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum_basin_size_pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the minimum size of basin in terms of contributing pixels at the outlet.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum_basin_size_pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">500000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is the maximum size of basin in terms of contributing pixels at the outlet.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_other_options_all_have_sensible_defaults">7.2.2. Other options: all have sensible defaults</h4>
<div class="paragraph">
<p>There are a number of other options you can choose in the <em>m/n</em> analysis but we have extensively tested the method on dozens of numerical and real test landscapes and the defaults work under most conditions. We encourage users to test the sensitivity of their results to these parameters, but for initial analyses you should not have to change any extra parameters.</p>
</div>
</div>
<div class="sect3">
<h4 id="_what_the_code_estimate_best_fit_movern_code_routine_does">7.2.3. What the <code>estimate_best_fit_movern</code> routine does</h4>
<div class="paragraph">
<p>If you set <code>estimate_best_fit_movern</code> you switch on all the routines for <em>m/n</em> analysis, and plotting of the data. These switches are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-paramfile" data-lang="paramfile"># we need to make sure we select basins the correct way
find_complete_basins_in_window: true
print_basin_raster: true
write_hillshade: true
print_chi_data_maps: true

# run the chi methods of estimating best fit m/n
this_bool_map["calculate_MLE_collinearity: true
calculate_MLE_collinearity_with_points_MC: true
print_profiles_fxn_movern_csv: true
movern_residuals_test: true

# run the SA methods of estimating best fit m/n
print_slope_area_data: true
segment_slope_area_data: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see what these do in the section: <a href="#_parameter_file_options">Parameter file options</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_em_m_n_em_analysis">7.3. Running the <em>m/n</em> analysis</h3>
<div class="paragraph">
<p>As with all of our tools, we suggest you keep your data and the source code seperate. We will assume the standard directory struture descrbed in the section: <a href="#_installing_the_code_and_setting_up_directories">Installing the code and setting up directories</a>.</p>
</div>
<div class="paragraph">
<p>We will assume your data is in the folder <code>/LSDTopoTools/Topographic_projects/LSDTT_chi_examples</code>, which you can clone from github.</p>
</div>
<div class="paragraph">
<p>A very simple driver file is in the example folder, called <code>movern_Xian.driver</code>. This is the driver function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-paramfile" data-lang="paramfile"># Parameters for performing chi analysis
# Comments are preceeded by the hash symbol
# Documentation can be found here:
# https://lsdtopotools.github.io/LSDTopoTools_ChiMudd2014/

# These are parameters for the file i/o
# IMPORTANT: You MUST make the write directory: the code will not work if it doens't exist.
read path: /LSDTopoTools/Topographic_projects/LSDTT_chi_examples
write path: /LSDTopoTools/Topographic_projects/LSDTT_chi_examples
read fname: Xian
write fname: movern_Xian
channel heads fname: NULL

# We remove parts of the landscape below 400 metres elevation to remove some alluvial fans.
minimum_elevation: 400

# Parameters for selecting channels and basins
threshold_contributing_pixels: 5000
minimum_basin_size_pixels: 150000
maximum_basin_size_pixels: 400000

# Everything you need for an m over n analysis
estimate_best_fit_movern: true</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All you need to do is run ths file using the <strong>chi_mapping_tool</strong>. If you followed instructions for installing the software, this tool will be in the directory <code>/LSDTopoTools/Git_projects/LSDTopoTools_</code>. Navigate to that folder:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ cd /LSDTopoTools/Git_projects/LSDTopoTool_ChiMudd2014/driver_functions_MuddChi2014/</code></pre>
</div>
</div>
</li>
<li>
<p>Now run the correct driver file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$ ./chi_mapping_tool.exe /LSDTopoTools/Topographic_projects/LSDTT_chi_examples movern_Xian.driver</code></pre>
</div>
</div>
</li>
<li>
<p>Congratulations! You have set your first movern analysis running. It might take a little while to work its way though all the analyses so sit back, relax, and catch up on some <a href="http://www.bbc.co.uk/football/hibernianfc/">important news</a>. When it finishes you will be ready to visualise your data.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_visualising_the_results_of_our_m_n_analyses">7.4. Visualising the results of our m/n analyses</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
You need to run the analysis before any of this will work!
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We have built a single python script that does all the visualisation for you. It works with one call to the script: <em>*easy peasy!!*</em></p>
</div>
<div class="paragraph">
<p>Unfortunately there are a few hiccups in getting the python installed, which we describe in the section <a href="#_setting_up_python">Setting up Python</a>.</p>
</div>
<div class="paragraph">
<p>This will be slightly different than instructions in that section, since the advice there is to run python scripts from <strong>spyder</strong>. In this instance, we will run from command line.</p>
</div>
<div class="sect3">
<h4 id="_generating_all_the_plots">7.4.1. Generating all the plots</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you are in Windows, you need to take care of a little problem first: <a href="#_fixing_python_gdal_in_windows">Fixing python gdal in windows</a></p>
</li>
<li>
<p>Now open a command shell window (search your star menu for <strong>cmd.exe</strong>).</p>
</li>
<li>
<p>If you have installed a conda environment for <strong>LSDTopoTools</strong> (see the section <a href="#_setting_up_python">Setting up Python</a> for details), activate it with:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">&gt; activate LSDTT</code></pre>
</div>
</div>
</li>
<li>
<p>Now, go to the place you cloned <strong>LSDMappingTools</strong>. For instructions on that look here: <a href="#_getting_our_plotting_tools">Getting our plotting tools</a>. You will need to use the <code>cd</code> command to get there.</p>
</li>
<li>
<p>Once you are in the correct directory, you need to run the python script:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">&gt; python PlotMoverNAnalysis.py -dir C:\VagrantBoxes\LSDTopoTools\Topographic_projects\LSDTT_chi_examples\ -fname movern_Xian -ALL True</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note here that we have assumed you have put your files, on your host machine, in <code>C:\VagrantBoxes\</code>. If your files are somewhere else you need to change this. The <code>-dir</code> flag wants the directory of the data and the <code>-fname</code> flag wants the prefix of the data. The <code>-ALL</code> flag means you want to do all the plotting.</p>
</div>
</li>
<li>
<p>This can take a little while. Why don&#8217;t you relax and <a href="https://www.youtube.com/watch?v=OcLhUiYrZhA">watch a video</a> while you wait?</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_what_sort_of_plots_do_i_get">7.4.2. What sort of plots do I get?</h4>
<div class="paragraph">
<p>In your data folder you will now find not one, but four new folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>raster_plots</code></p>
</li>
<li>
<p><code>SA_plots</code></p>
</li>
<li>
<p><code>chi_plots</code></p>
</li>
<li>
<p><code>summary_plots</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These contain a cornucopia of images for you to explore.</p>
</div>
<div class="sect4">
<h5 id="_figures_in_the_raster_plots_folder">Figures in the Raster_plots folder</h5>
<div class="paragraph">
<p>The <strong>raster_plots</strong> directory contains images of the extracted basins:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/movern_Xian_basin_keys.png" alt="Basins around Mount Hua for _m/n_ analysis">
</div>
<div class="title">Figure 4. The extracted basins for the <em>m/n</em> analysis</div>
</div>
<div class="paragraph">
<p>It also contains images of the most likeley <em>m/n</em> ratio following three methods: slope-area analysis, collinearity analysis of chi profiles using all channel points, and collinearity using chi points at random intervals iterated upon using a Monte-Carlo scheme. Our extensive testing against numerical models under ideal conditions suggest the least trustworthy of these extracted <em>m/n</em> ratios is the slope-area data, whereas the most trustworthy are the data derived from the Monte Carlo chi approach. It is not possible to know which of these methods is "true" but if all methods agree you can have high confidence in the <em>m/n</em> ratio and if they disagree our guidance is to use the Monte Carlo chi method.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/movern_Xian_basins_movern_chi_points.png" alt="Mount Hua Monte Carlo chi results">
</div>
<div class="title">Figure 5. The most likely <em>m/n</em> values using collinearity test of chi profiles with Monte Carlo sampling</div>
</div>
</div>
<div class="sect4">
<h5 id="_figures_in_the_sa_plots_folder">Figures in the SA_plots folder</h5>
<div class="paragraph">
<p>This folder contains two versions of slope-area plots. The first contains the slope area data of all the tributaries, for example:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/movern_Xian_SA_plot_raw_and_binned_basin6.png" alt="S-A data of all channels in the basin">
</div>
<div class="title">Figure 6. S-A data of all channels in the basin</div>
</div>
<div class="paragraph">
<p>The second set of S-A data contains only the trunk channel and also has segments extracted from the <a href="http://www.http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/abstract">Mudd et al. (2014)</a> segmentation algorithm.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/movern_Xian_SA_plot_raw_and_segmented_basin6.png" alt="S-A of trunk with segments">
</div>
<div class="title">Figure 7. S-A data of the trunk stream with statistically extracted segments.</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_interpreting_results_from_the_m_n_analyses_and_pitfalls">7.5. Interpreting results from the m/n analyses and pitfalls</h3>
<div class="paragraph">
<p>We have tested these routines across a number of landscapes and hope that other workers will find them useful and enhance their own work. Here we explore a number of issues we have come across in interpreting results from these analyses.</p>
</div>
<div class="sect3">
<h4 id="_uncertainty_and_confidence_in_the_results">7.5.1. Uncertainty and confidence in the results</h4>

</div>
<div class="sect3">
<h4 id="_parameter_values_that_appear_to_influence_results">7.5.2. Parameter values that appear to influence results</h4>

</div>
<div class="sect3">
<h4 id="_some_typical_landscapes">7.5.3. Some typical landscapes</h4>

</div>
<div class="sect3">
<h4 id="_advice_for_presenting_results">7.5.4. Advice for presenting results</h4>

</div>
<div class="sect3">
<h4 id="_troubleshooting">7.5.5. Troubleshooting</h4>

</div>
</div>
<div class="sect2">
<h3 id="_files_output_by_the_m_n_analysis">7.6. Files output by the m/n analysis</h3>
<div class="paragraph">
<p>The \(m/n\) analysis will produce a number of new files in both raster and comma seperated value formats. You can also tell the code to print csv files to geojson files if you want to directly load them into your favourite GIS.</p>
</div>
<div class="paragraph">
<p>We expect most users will go straight to the figures generated by our python script, which should be publication quality. However, we list here the file outputs so you can inspect the data outputs ith which you can create your own plotting routines, if you so wish. We believe data should be transparent and reproducible, so all our python plots make figures from data that has been printed to file: you will always be able to see the data behind the figures. Please do not abuse our willingness to do this by taking our data an publishing horrible figures created in excel.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 16. Raster files</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Filename contains</th>
<th class="tableblock halign-left valign-top">File type</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">estimate_best_fit_movern</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">You need to switch this to <code>true</code> to perform all the analysis for channel concavity or <em>m/n</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">collinearity_MLE_sigma</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_all_options_used_in_the_m_n_analyses">7.7. All options used in the m/n analyses</h3>
<div class="paragraph">
<p>This is a complete list of the options that are used in the \(m/n\) analysis. Note that many other options are possible for printing, basin selection and output data formats. You will find all possible options in the section: <a href="#_parameter_file_options">Parameter file options</a>. What is reported below is just repeated from that section.</p>
</div>
<div class="sect3">
<h4 id="_parameters_for_exploring_the_em_m_n_em_ratio_with_chi_analysis_2">7.7.1. Parameters for exploring the <em>m/n</em> ratio with chi analysis</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 17. Parameters for trying to constrain the <em>m/n</em> ratio using chi analysis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">start_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In several of the <em>m/n</em> testing functions, the program starts at this <em>m/n</em> value and then iterates through a number of increasing <em>m/n</em> values, calculating the goodness of fit to each one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">delta_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In several of the <em>m/n</em> testing functions, the program increments <em>m/n</em> by this value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n_movern</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In several of the <em>m/n</em> testing functions, the program increments <em>m/n</em> this number of times.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">only_use_mainstem_as_reference</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true this compares the goodness of fit between the mainstem and all tributaries in each basin for each <em>m/n</em> value. If false, it compares <strong>all</strong> tributaries and the main stem to every other tributary.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the goodness of fit between tributaries and the main stem. It reports back both MLE and RMSE values. Used to determine <em>m/n</em> ratios. This uses <strong>ALL</strong> nodes in the channel network. The effect is that longer channels have greater influence of the result than small channels.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity_with_points</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the goodness of fit between tributaries and the main stem. It reports back both MLE and RMSE values. Used to determine <em>m/n</em> ratios. It uses specific points on tributaries to conpare the the mainstem. These are located at fixed chi distances upstream of the lower junction of the tributary. The effect is to ensure that all tributaries are weighted similarly in calculating <em>m/n</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">calculate_MLE_collinearity_with_points_MC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the goodness of fit between tributaries and the main stem. It reports back both MLE and RMSE values. Used to determine <em>m/n</em> ratios. It uses specific points on tributaries to conpare the the mainstem. The location of these points is selected at random and this process is reapeated a number of times (the default is 1000) to quantify uncertanty in the best fit <em>m/n</em> ration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">collinearity_MLE_sigma</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A value that scales MLE. It does not afffect which <em>m/n</em> value is the most likeley. However it affects the absolute value of MLE. If it is set too low, MLE values for poorly fit segments will be zero. We have performed sensitivity and found that once all channels have nonzero MLE values the most likely channel does not change. So this should be set high enough to ensure there are nonzero MLE values for all tributaries. Set this too high, however, and all MLE values will be very close to 1 so plotting becomes difficult as the difference between MLE are at many significant digits (e.g., 0.9999997 vs 0.9999996). We have found that a value of 1000 works in most situations.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC_point_fractions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the <code>calculate_MLE_collinearity_with_points_MC</code> analysis, this is the number of points on each tributary to test against the main stem channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MC_point_iterations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For the <code>calculate_MLE_collinearity_with_points_MC</code> analysis, this is the number iterations of drawing random points with which to build best fit <em>m/n</em> statistics.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_MC_point_fraction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum fraction of the length, in chi, of the main stem that points will be measured over the tributary. For example, if the main stem has a chi lenght of 2 metres, then points on tributaries up to 1 metres from the conluence with the main stem will be tested by the <code>calculate_MLE_collinearity_with_points_MC</code> routine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">movern_residuals_test</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true loops though every <em>m/n</em> value and calculates the mean residual between the main stem and all the tributary nodes. It is used to search for the <em>m/n</em> value where the residual switches from negative to positive. The rationale is that the correct <em>m/n</em> might be reflected where the mean residual is closest to zero.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_profiles_fxn_movern_csv</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true this loops though every <em>m/n</em> value and prints (to a single csv file) all the chi-elevation profiles. Used to visualise the effect of changing the <em>m/n</em> ratio on the profiles.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_movern_analysis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, runs a Monte Carlo Markov Chain analysis of the best fit <em>m/n</em>. First attempts to tune the sigma value for the profuiles to get an MCMC acceptance rate of 25%, then runs a chain to contrain uncertainties. At the moment the tuning doesn&#8217;t seem to be working properly!! This is also extremely computationally expensive, for a, say, 10Mb DEM analysis might last several days on a single CPU core. If you want uncertainty values for the <em>m/n</em> ratio you should use the <code>calculate_MLE_collinearity_with_points_MC</code> routine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_chain_links</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of links in the MCMC chain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_movern_minimum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.05</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Minimum value of the <em>m/n</em> ratio tested by the MCMC routine.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCMC_movern_maximum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum value of the <em>m/n</em> ratio tested by the MCMC routine.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_parameters_for_exploring_the_em_m_n_em_ratio_with_slope_area_analysis_2">7.7.2. Parameters for exploring the <em>m/n</em> ratio with slope-area analysis</h4>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 18. Parameters for exploring the <em>m/n</em> ratio with slope-area analysis</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Keyword</th>
<th class="tableblock halign-left valign-top">Input type</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SA_vertical_interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This parameter is used for slope-area analysis. Each channel is traced downslope. A slope (or gradient) is calculated by dividing the fall in the channel elevation over the flow distance; the program aims to calculate the slope at as near to a fixed vertical interval as possible following advice of Wobus et al 2006.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_A_bin_width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is for slope-area analysis. The raw slope-area data is always a horrendous mess. To get something that is remotely sensible you must bin the data. We bin the data in bins of the logarithm of the Area in metres^2. This is the log bin width.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_slope_area_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This prints the slope-area analysis to a csv file. It includes the raw data and binned data. It is organised by both source and basin so you analyise different channels. See the section on outputs for full details.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">segment_slope_area_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If true, uses the segmentation algorithm in <a href="http://onlinelibrary.wiley.com/doi/10.1002/2013JF002981/abstract">Mudd et al., JGR-ES 2014</a> to segment the log-binned S-A data for the main stem channel.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">slope_area_minimum_segment_length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the minimum segment lenght of a fitted segment to the S-A data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootstrap_SA_data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This bootstraps S-A data by removing a fraction of the data (set below) in each iteration and calculating the regression coefficients. It is used to estimate uncertainty, but it deosn&#8217;t really work since uncertainty in regression coefficients reduces with more samples and S-A datasets have thousands of samples. Left here as a kind of monument to our futile efforts.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N_SA_bootstrap_iterations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of boostrapping iterations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SA_bootstrap_retain_node_prbability</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">float</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fraction of the data retained in each bootstrapping iteration.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-09-08 15:09:33 GMT Daylight Time
</div>
</div>
</body>
</html>